/*!
* rete-scopes-plugin v2.0.0
* (c) 2024 Vitaliy Stoliarov
* Released under the CC-BY-NC-SA-4.0 license.
* */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rete"),require("rete-area-plugin")):"function"==typeof define&&define.amd?define(["exports","rete","rete-area-plugin"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ReteScopesPlugin={},e.Rete,e.ReteAreaPlugin)}(this,(function(e,t,r){"use strict";function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(){i=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(e){f=function(e,t,r){return e[t]=r}}function s(e,t,r,o){var i=t&&t.prototype instanceof d?t:d,a=Object.create(i.prototype),u=new j(o||[]);return n(a,"_invoke",{value:O(e,r,u)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var p={};function d(){}function h(){}function y(){}var v={};f(v,a,(function(){return this}));var g=Object.getPrototypeOf,w=g&&g(g(N([])));w&&w!==t&&r.call(w,a)&&(v=w);var m=y.prototype=d.prototype=Object.create(v);function b(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(n,i,a,u){var c=l(e[n],e,i);if("throw"!==c.type){var f=c.arg,s=f.value;return s&&"object"==typeof s&&r.call(s,"__await")?t.resolve(s.__await).then((function(e){o("next",e,a,u)}),(function(e){o("throw",e,a,u)})):t.resolve(s).then((function(e){f.value=e,a(f)}),(function(e){return o("throw",e,a,u)}))}u(c.arg)}var i;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){o(e,r,t,n)}))}return i=i?i.then(n,n):n()}})}function O(e,t,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return _()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=k(a,r);if(u){if(u===p)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var c=l(e,t,r);if("normal"===c.type){if(n=r.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n="completed",r.method="throw",r.arg=c.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),p;var o=l(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,p;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function j(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function N(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:_}}function _(){return{value:void 0,done:!0}}return h.prototype=y,n(m,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:h,configurable:!0}),h.displayName=f(y,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,f(e,c,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},b(x.prototype),f(x.prototype,u,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(s(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},b(m),f(m,c,"Generator"),f(m,a,(function(){return this})),f(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=N,j.prototype={constructor:j,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,p):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:N(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),p}},e}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function u(e,t,r,n,o,i,a){try{var u=e[i](a),c=u.value}catch(e){return void r(e)}u.done?t(c):Promise.resolve(c).then(n,o)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(e){u(i,n,o,a,c,"next",e)}function c(e){u(i,n,o,a,c,"throw",e)}a(void 0)}))}}function f(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,b(n.key),n)}}function s(e,t,r){return(t=b(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function p(e,t){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},p(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=l(e);if(t){var o=l(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return d(e)}(this,r)}}function y(){return y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},y.apply(this,arguments)}function v(e){return function(e){if(Array.isArray(e))return w(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return w(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function m(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=g(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){u=!0,i=e},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}function b(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function x(e,t){var r=t.area.connectionViews.get(e),n=t.area.area.content;r&&n.reorder(r.element,n.holder.firstChild)}function O(e,t){var r=t.area.nodeViews.get(e),n=t.editor.getConnections().filter((function(t){return e===t.source||e===t.target})),o=t.editor.getNodes().filter((function(t){return t.parent===e}));n.forEach((function(e){return function(e,t){var r=t.area.connectionViews.get(e);r&&t.area.area.content.reorder(r.element,null)}(e.id,t)})),r&&t.area.area.content.reorder(r.element,null),o.forEach((function(e){return O(e.id,t)}))}function k(e,t){var r=t.area,n=e.map((function(e){var t=r.nodeViews.get(e.id);if(!t)throw new Error("view");return{position:t.position,width:e.width,height:e.height}})),o=Math.min.apply(Math,v(n.map((function(e){return e.position.x})))),i=Math.max.apply(Math,v(n.map((function(e){return e.position.x+e.width})))),a=Math.min.apply(Math,v(n.map((function(e){return e.position.y})))),u=Math.max.apply(Math,v(n.map((function(e){return e.position.y+e.height}))));return{top:a,left:o,right:i,bottom:u,width:i-o,height:u-a}}function E(e,t,r){var n=r.area,o=t.width,i=t.height;e.width=o,e.height=i,n.resize(e.id,o,i)}function P(e,t,r){return j.apply(this,arguments)}function j(){return(j=c(i().mark((function e(t,r,n){var o,a,u,c,f,s,l,p,d,h,y,v,g,w;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.id,a=n.editor.getNodes().filter((function(e){return e.parent===o})).filter((function(e){return!r.exclude(e.id)})),u=r.padding(o),0!==a.length){e.next=8;break}c=r.size(o,{width:u.left+u.right,height:u.top+u.bottom}),E(t,c,n),e.next=16;break;case 8:return f=k(a,n),s=f.top,l=f.left,p=f.width,d=f.height,h=p+u.left+u.right,y=d+u.top+u.bottom,v=s-u.top,g=l-u.left,E(t,r.size(o,{width:h,height:y}),n),e.next=16,r.translate(t.id,g,v);case 16:if(!t.parent){e.next=21;break}if(!(w=n.editor.getNode(t.parent))){e.next=21;break}return e.next=21,P(w,r,n);case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,r,n){return _.apply(this,arguments)}function _(){return(_=c(i().mark((function e(t,r,n,o){var a,u,c,f,s,l,p,d,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return");case 2:if(a=t.map((function(e){return o.editor.getNode(e)})).filter((function(e){return Boolean(e)})),u=o.editor.getNodes().map((function(e){var t=o.area.nodeViews.get(e.id);if(!t)throw new Error("node view");return{node:e,view:t}})).filter((function(e){var n=e.node,o=e.view;return!t.includes(n.id)&&r.x>o.position.x&&r.y>o.position.y&&r.x<o.position.x+n.width&&r.y<o.position.y+n.height})),c=Array.from(o.area.area.content.holder.childNodes),(f=u.map((function(e){var t=e.node,r=e.view;return{node:t,view:r,index:c.indexOf(r.element)}}))).sort((function(e,t){return t.index-e.index})),s=f[0],l=a.map((function(e){return e.parent})).filter((function(e){return Boolean(e)})).map((function(e){var t=o.editor.getNode(e);if(!t)throw new Error("node");return t})),a.forEach((function(e){return e.parent=void 0})),!s){e.next=14;break}return a.forEach((function(e){return e.parent=s.node.id})),e.next=14,P(s.node,n,o);case 14:p=m(l),e.prev=15,p.s();case 17:if((d=p.n()).done){e.next=23;break}return h=d.value,e.next=21,P(h,n,o);case 21:e.next=17;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(15),p.e(e.t0);case 28:return e.prev=28,p.f(),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[15,25,28,31]])})))).apply(this,arguments)}function S(e,t,r){return L.apply(this,arguments)}function L(){return L=c(i().mark((function e(t,r,n){var o,a,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.position,a=r.previous,u=n.editor.getNodes().filter((function(e){return e.parent===t})),e.next=4,Promise.all(u.map(function(){var e=c(i().mark((function e(t){var r,u,c,f,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.x-a.x,u=o.y-a.y,c=n.area.nodeViews.get(t.id),f=n.editor.getNode(t.id),!c||!f||f.selected){e.next=8;break}return s=c.position,e.next=8,c.translate(s.x+r,s.y+u);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function T(e,t,r){var n=r.editor.getNode(e);if(!n)throw new Error("node");return!!t.includes(e)||!!n.parent&&(!!T(n.parent,t,r)||void 0)}function A(e,t){var r=t.editor.getNode(e);if(!r)throw new Error("node");if(!r.parent)return!1;var n=t.editor.getNode(r.parent);if(!n)throw new Error("node");return!!n.selected||A(r.parent,t)}var R=Object.freeze({__proto__:null,setup:function(){return function(e,t){!function(e,t){var r=t.area,n=t.editor,o=t.scopes,a=e.timeout||250,u=null,f=[];function s(){u&&(window.clearTimeout(u.timeout),u=null)}function l(e){var t=window.setTimeout((function(){var t,r=n.getNodes().filter((function(e){return e.selected})),i=r.length?r.map((function(e){return e.id})):[e];(t=f).push.apply(t,v(i)),o.emit({type:"scopepicked",data:{ids:i}})}),a);u={timeout:t}}r.addPipe(function(){var t=c(i().mark((function t(a){var u,c;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("type"in a){t.next=2;break}return t.abrupt("return",a);case 2:if("nodepicked"===a.type&&l(a.data.id),"nodetranslated"===a.type&&s(),"nodedragged"!==a.type){t.next=9;break}return u=r.area.pointer,i=void 0,i=v(f),s(),f=[],o.emit({type:"scopereleased",data:{ids:i}}),c=i,t.next=9,N(c,u,e,{area:r,editor:n});case 9:return t.abrupt("return",a);case 10:case"end":return t.stop()}var i}),t)})));return function(e){return t.apply(this,arguments)}}())}(e,t),function(e){var t=e.area,r=e.editor,n=e.scopes,o=z(n),i=null,a=null;function u(e,n){if(i){var o=t.nodeViews.get(i);o&&n.length&&(o.element.style.opacity="0.4"),i=null}if(n.length){var a=e.x,u=e.y,c=document.elementsFromPoint(a,u),f=r.getNodes().map((function(e){var r=t.nodeViews.get(e.id);if(!r)throw new Error("view");return{node:e,view:r}})),s=c.map((function(e){return f.find((function(t){return t.view.element===e}))})).filter((function(e){return Boolean(e)})).filter((function(e){return!e.node.selected}))[0];s&&(s.view.element.style.opacity="0.8",i=s.node.id)}}n.addPipe((function(e){if("scopepicked"===e.type){var n=e.data.ids;r.getNodes().filter((function(e){return!n.includes(e.id)})).forEach((function(e){var r=t.nodeViews.get(e.id);r&&(r.element.style.opacity="0.4")})),a&&u(a,o)}if("scopereleased"===e.type){var i=e.data.ids;r.getNodes().filter((function(e){return!i.includes(e.id)})).forEach((function(e){var r=t.nodeViews.get(e.id);r&&(r.element.style.opacity="")})),a&&u(a,o)}return"pointermove"===e.type&&u(a={x:e.data.event.clientX,y:e.data.event.clientY},o),e}))}(t)}}}),M=Object.freeze({__proto__:null,classic:R}),V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}(w,e);var n,u,v,g=h(w);function w(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,w),s(d(t=g.call(this,"scopes")),"presets",[]),t.padding=(null==e?void 0:e.padding)||function(){return{top:40,left:20,right:20,bottom:20}},t.exclude=(null==e?void 0:e.exclude)||function(){return!1},t.size=(null==e?void 0:e.size)||function(e,t){return t},t}return n=w,u=[{key:"setParent",value:function(e){var n=this;y(l(w.prototype),"setParent",this).call(this,e),this.area=this.parentScope(r.BaseAreaPlugin),this.editor=this.area.parentScope(t.NodeEditor);var u={editor:this.editor,area:this.area},f=this.padding,s=this.size,p=this.exclude,d=z(this),h=function(e){var t=new Map,r=function(e){return t.set(e,(t.get(e)||0)+1)},n=function(e){return t.set(e,(t.get(e)||0)-1)};return{translate:function(t,o,a){return c(i().mark((function u(){var c,f;return i().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(c=e.area.nodeViews.get(t)){i.next=3;break}throw new Error("cannot find parent node view");case 3:if((f=c.position).x===o&&f.y===a){i.next=9;break}return r(t),i.next=8,c.translate(o,a);case 8:n(t);case 9:case"end":return i.stop()}}),u)})))()},isTranslating:function(e){return(t.get(e)||0)>0}}}(u),v=h.translate,g=h.isTranslating,m={padding:f,size:s,exclude:p,translate:v};!function(e){var t,r,n=(t=e.editor,r=!1,t.addPipe((function(e){return"clear"===e.type&&(r=!0),"cleared"!==e.type&&"clearcancelled"!==e.type||(r=!1),e})),function(){return r});e.area.addPipe((function(t){if(!t||"object"!==a(t)||!("type"in t))return t;if("nodecreate"===t.type){var r=t.data.parent;if(r&&!e.editor.getNodes().find((function(e){return e.id===r})))throw new Error("parent node doesnt exist")}if("noderemove"===t.type&&!n()){var o=t.data.id;if(e.editor.getNodes().find((function(e){return e.parent===o})))throw new Error("cannot remove parent node with a children")}return t}))}(u),function(e){e.area.addPipe(function(){var t=c(i().mark((function t(r){var n,o;return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("type"in r){t.next=2;break}return t.abrupt("return",r);case 2:if("nodepicked"===r.type&&O(r.data.id,e),"connectioncreated"!==r.type){t.next=11;break}if(n=r.data.id,o=e.editor.getConnection(n)){t.next=8;break}throw new Error("connection was removed");case 8:x(r.data.id,e),O(o.source,e),O(o.target,e);case 11:return t.abrupt("return",r);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}(u),this.presets.forEach((function(e){e(m,o(o({},u),{},{scopes:n}))})),this.addPipe(function(){var e=c(i().mark((function e(t){var r,n,o,a,c,f,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("nodetranslated"!==t.type){e.next=15;break}if(r=t.data.id,n=u.editor.getNode(r)){e.next=5;break}throw new Error("cannot find node");case 5:if(g(r)){e.next=8;break}return e.next=8,S(r,t.data,u);case 8:if(!(o=n.parent?u.editor.getNode(n.parent):null)||m.exclude(r)){e.next=15;break}if(a=A(r,u),c=T(n.id,d,u),a||c){e.next=15;break}return e.next=15,P(o,m,u);case 15:if("noderemoved"!==t.type){e.next=21;break}if(f=t.data.parent,!(s=f&&u.editor.getNode(f))){e.next=21;break}return e.next=21,P(s,m,u);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"addPreset",value:function(e){this.presets.push(e)}},{key:"isDependent",value:function(e){var t={editor:this.editor,area:this.area},r=this.editor.getNode(e);return r&&(r.selected||A(e,t))}}],u&&f(n.prototype,u),v&&f(n,v),Object.defineProperty(n,"prototype",{writable:!1}),w}(t.Scope);function z(e){var t=[];return e.addPipe(function(){var e=c(i().mark((function e(r){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("type"in r){e.next=2;break}return e.abrupt("return",r);case 2:return"scopepicked"===r.type&&t.push.apply(t,v(r.data.ids)),"scopereleased"===r.type&&t.splice.apply(t,[0,t.length].concat(v(t.filter((function(e){return!r.data.ids.includes(e)}))))),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t}e.Presets=M,e.ScopesPlugin=V,e.getPickedNodes=z,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rete-scopes-plugin.min.js.map
