{"version":3,"file":"rete-scopes-plugin.min.js","sources":["src/ordering.ts","src/sizing.ts","src/scope.ts","src/utils.ts","src/presets/classic/index.ts","src/agents/classic/index.ts","src/index.ts","src/validation.ts"],"sourcesContent":["import { ConnectionId, NodeEditor, NodeId } from 'rete'\nimport { BaseArea, BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { ExpectedScheme } from './types'\n\ntype Props<T> = { editor: NodeEditor<ExpectedScheme>, area: BaseAreaPlugin<ExpectedScheme, BaseArea<ExpectedScheme> | T> }\n\nfunction bringConnectionForward<T>(id: ConnectionId, props: Props<T>) {\n  const view = props.area.connectionViews.get(id)\n\n  if (view) {\n    props.area.area.content.reorder(view.element, null)\n  }\n}\n\nfunction bringConnectionBack<T>(id: ConnectionId, props: Props<T>) {\n  const view = props.area.connectionViews.get(id)\n  const { content } = props.area.area\n\n  if (view) {\n    content.reorder(view.element, content.holder.firstChild)\n  }\n}\n\nfunction bringForward<T>(nodeId: NodeId, props: Props<T>) {\n  const view = props.area.nodeViews.get(nodeId)\n  const connections = props.editor.getConnections().filter(c => {\n    return nodeId === c.source || nodeId === c.target\n  })\n  const children = props.editor.getNodes().filter(n => {\n    return n.parent === nodeId\n  })\n\n  connections.forEach(connection => bringConnectionForward(connection.id, props))\n\n  if (view) {\n    props.area.area.content.reorder(view.element, null)\n  }\n\n  children.forEach(child => bringForward(child.id, props))\n}\n\nexport function useOrdering<T>(props: Props<T>) {\n  // eslint-disable-next-line max-statements\n  props.area.addPipe(async context => {\n    if (!('type' in context)) return context\n    if (context.type === 'nodepicked') {\n      bringForward(context.data.id, props)\n    }\n    if (context.type === 'connectioncreated') {\n      const { id } = context.data\n      const connection = props.editor.getConnection(id)\n\n      if (!connection) throw new Error('connection was removed')\n      bringConnectionBack(context.data.id, props)\n      bringForward(connection.source, props)\n      bringForward(connection.target, props)\n    }\n    return context\n  })\n}\n","import { NodeEditor } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { AgentParams } from './agents/types'\nimport { ExpectedScheme } from './types'\n\ntype Props<T> = { editor: NodeEditor<ExpectedScheme>, area: BaseAreaPlugin<ExpectedScheme, T> }\n\nexport function getNodesBoundingBox<T>(nodes: ExpectedScheme['Node'][], { area }: Props<T>) {\n  const boxes = nodes.map(node => {\n    const view = area.nodeViews.get(node.id)\n\n    if (!view) throw new Error('view')\n\n    return {\n      position: view.position,\n      width: node.width,\n      height: node.height\n    }\n  })\n\n  const left = Math.min(...boxes.map(b => b.position.x))\n  const right = Math.max(...boxes.map(b => b.position.x + b.width))\n  const top = Math.min(...boxes.map(b => b.position.y))\n  const bottom = Math.max(...boxes.map(b => b.position.y + b.height))\n  const width = right - left\n  const height = bottom - top\n\n  return {\n    top,\n    left,\n    right,\n    bottom,\n    width,\n    height\n  }\n}\n\ntype Size = { width: number, height: number }\n\nexport function updateNodeSizes<T>(node: ExpectedScheme['Node'], size: Size, { area }: Props<T>) {\n  const { width, height } = size\n\n  node.width = width\n  node.height = height\n\n  area.resize(node.id, width, height)\n}\n\n// eslint-disable-next-line max-statements\nexport async function resizeParent<T>(parent: ExpectedScheme['Node'], agentParams: AgentParams, props: Props<T>) {\n  const { id } = parent\n  const children = props.editor.getNodes()\n    .filter(child => child.parent === id)\n    .filter(node => !agentParams.exclude(node.id))\n  const padding = agentParams.padding(id)\n\n  if (children.length === 0) {\n    const size = agentParams.size(id, {\n      width: padding.left + padding.right,\n      height: padding.top + padding.bottom\n    })\n\n    updateNodeSizes(parent, size, props)\n  } else {\n    const { top, left, width, height } = getNodesBoundingBox(children, props)\n\n    const outerWidth = width + padding.left + padding.right\n    const outerHeight = height + padding.top + padding.bottom\n    const outerTop = top - padding.top\n    const outerLeft = left - padding.left\n\n    updateNodeSizes(parent, agentParams.size(id, { width: outerWidth, height: outerHeight }), props)\n    await agentParams.translate(parent.id, outerLeft, outerTop)\n  }\n  if (parent.parent) {\n    const parentsParent = props.editor.getNode(parent.parent)\n\n    if (parentsParent) {\n      await resizeParent(parentsParent, agentParams, props)\n    }\n  }\n}\n","import { NodeEditor, NodeId } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { AgentParams } from './agents/types'\nimport { resizeParent } from './sizing'\nimport { ExpectedScheme, Position } from './types'\n\ntype Props<T> = { editor: NodeEditor<ExpectedScheme>, area: BaseAreaPlugin<ExpectedScheme, T> }\n\n// eslint-disable-next-line max-statements, max-len\nexport async function reassignParent<T>(ids: NodeId[], pointer: { x: number, y: number }, agentParams: AgentParams, props: Props<T>) {\n  if (!ids.length) return\n  const nodes = ids\n    .map(id => props.editor.getNode(id))\n    .filter((n): n is ExpectedScheme['Node'] => Boolean(n))\n\n  const overlayNodes = props.editor.getNodes()\n    .map(node => {\n      const view = props.area.nodeViews.get(node.id)\n\n      if (!view) throw new Error('node view')\n\n      return { node, view }\n    }).filter(({ node, view }) => {\n      return !ids.includes(node.id)\n        && pointer.x > view.position.x\n        && pointer.y > view.position.y\n        && pointer.x < view.position.x + node.width\n        && pointer.y < view.position.y + node.height\n    })\n  const areaElements = Array.from(props.area.area.content.holder.childNodes)\n  const overlayNodesWithIndex = overlayNodes.map(({ node, view }) => {\n    const index = areaElements.indexOf(view.element)\n\n    return { node, view, index }\n  })\n\n  overlayNodesWithIndex.sort((a, b) => b.index - a.index)\n  const topOverlayParent = overlayNodesWithIndex[0]\n\n  const formerParents = nodes\n    .map(node => node.parent)\n    .filter((id): id is string => Boolean(id))\n    .map(id => {\n      const node = props.editor.getNode(id)\n\n      if (!node) throw new Error('node')\n\n      return node\n    })\n\n  // eslint-disable-next-line no-undefined\n  nodes.forEach(node => node.parent = undefined)\n  if (topOverlayParent) {\n    nodes.forEach(node => node.parent = topOverlayParent.node.id)\n    await resizeParent(topOverlayParent.node, agentParams, props)\n  }\n\n  for (const formerParent of formerParents) {\n    await resizeParent(formerParent, agentParams, props)\n  }\n}\n\nexport async function translateChildren<T>(id: NodeId, { position, previous }: { position: Position, previous: Position }, props: Props<T>) {\n  const children = props.editor.getNodes().filter(n => n.parent === id)\n\n  await Promise.all(children.map(async n => {\n    const dx = position.x - previous.x\n    const dy = position.y - previous.y\n\n    const view = props.area.nodeViews.get(n.id)\n    const node = props.editor.getNode(n.id)\n\n    if (view && node && !node.selected) {\n      const nodePosition = view.position\n\n      await view.translate(nodePosition.x + dx, nodePosition.y + dy)\n    }\n  }))\n}\n","import { BaseSchemes, NodeEditor, NodeId } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { ExpectedScheme } from './types'\n\ntype Props<T> = { editor: NodeEditor<ExpectedScheme>, area: BaseAreaPlugin<ExpectedScheme, T> }\n\nexport function belongsTo<T>(nodeId: NodeId, ids: NodeId[], props: Props<T>) {\n  const node = props.editor.getNode(nodeId)\n\n  if (!node) throw new Error('node')\n\n  if (ids.includes(nodeId)) return true\n  if (!node.parent) return false\n  if (belongsTo(node.parent, ids, props)) return true\n}\n\nexport function hasSelectedParent<T>(nodeId: NodeId, props: Props<T>): boolean {\n  const node = props.editor.getNode(nodeId)\n\n  if (!node) throw new Error('node')\n\n  if (!node.parent) return false\n\n  const parent = props.editor.getNode(node.parent)\n\n  if (!parent) throw new Error('node')\n\n  if (parent.selected) return true\n\n  return hasSelectedParent(node.parent, props)\n}\n\nexport type Translate = (nodeId: string, x: number, y: number) => Promise<void>\n\n/**\n * keep track of currently moving nodes (to prevent infinite loop)\n */\nexport function trackedTranslate<T>(props: Props<T>): {\n  translate: Translate,\n  isTranslating: (id: NodeId) => boolean\n} {\n  const active = new Map<NodeId, number>()\n  const increment = (id: NodeId) => active.set(id, (active.get(id) || 0) + 1)\n  const decrement = (id: NodeId) => active.set(id, (active.get(id) || 0) - 1)\n\n  return {\n    async translate(id, x, y) {\n      const view = props.area.nodeViews.get(id)\n\n      if (!view) throw new Error('cannot find parent node view')\n\n      const previous = view.position\n\n      if (previous.x !== x || previous.y !== y) {\n        increment(id)\n        await view.translate(x, y)\n        decrement(id)\n      }\n    },\n    isTranslating(id) {\n      return (active.get(id) || 0) > 0\n    }\n  }\n}\n\nexport function watchClearing(editor: NodeEditor<BaseSchemes>) {\n  let state = false\n\n  editor.addPipe(context => {\n    if (context.type === 'clear') {\n      state = true\n    }\n    if (context.type === 'cleared' || context.type === 'clearcancelled') {\n      state = false\n    }\n    return context\n  })\n\n  return () => state\n}\n","import { classic } from '../../agents'\nimport { Preset } from '../types'\n\n/**\n * Classic preset allowing capturing a node by long-pressing it and dropping it onto another node to make it a nested.\n * @returns Preset\n * @listens nodepicked\n * @listens nodetranslated\n * @listens nodedragged\n * @emits scopepicked\n * @emits scopereleased\n */\nexport function setup(): Preset {\n  return (params, context) => {\n    classic.useScopeAgent(params, context)\n    classic.useVisualEffects(context)\n  }\n}\n","import { NodeId } from 'rete'\n\nimport { getPickedNodes } from '../..'\nimport { reassignParent } from '../../scope'\nimport { Position } from '../../types'\nimport { AgentContext, AgentParams, ScopeAgent } from '../types'\n\nexport type DefaultScopesAgentParams = AgentParams & {\n  timeout?: number\n}\n\nexport const useScopeAgent: ScopeAgent = (params: DefaultScopesAgentParams, { area, editor, scopes }) => {\n  const timeout = params.timeout || 250\n\n  let picked: { timeout: number } | null = null\n  let candidates: string[] = []\n\n  function cancel() {\n    if (picked) {\n      window.clearTimeout(picked.timeout)\n      picked = null\n    }\n  }\n\n  function pick(id: NodeId) {\n    const timeoutId = window.setTimeout(() => {\n      const selected = editor.getNodes().filter(n => n.selected)\n      const targets = selected.length ? selected.map(n => n.id) : [id]\n\n      candidates.push(...targets)\n      scopes.emit({ type: 'scopepicked', data: { ids: targets } })\n    }, timeout)\n\n    picked = { timeout: timeoutId }\n  }\n  function release() {\n    const list = [...candidates]\n\n    cancel()\n    candidates = []\n\n    scopes.emit({ type: 'scopereleased', data: { ids: list } })\n\n    return list\n  }\n\n  area.addPipe(async context => {\n    if (!('type' in context)) return context\n    if (context.type === 'nodepicked') {\n      pick(context.data.id)\n    }\n    if (context.type === 'nodetranslated') {\n      cancel()\n    }\n    if (context.type === 'nodedragged') {\n      const { pointer } = area.area\n      const ids = release()\n\n      await reassignParent(ids, pointer, params, { area, editor })\n    }\n    return context\n  })\n}\n\nexport function useVisualEffects<T>({ area, editor, scopes }: AgentContext<T>): void {\n  const pickedNodes = getPickedNodes(scopes)\n  let previousHighlighted: string | null = null\n  let clientPointerPostion: Position | null = null\n\n  // eslint-disable-next-line max-statements\n  function updateHighlightedScopes(position: { x: number, y: number }, nodes: NodeId[]) {\n    if (previousHighlighted) {\n      const view = area.nodeViews.get(previousHighlighted)\n\n      if (view && nodes.length) view.element.style.opacity = '0.4'\n      previousHighlighted = null\n    }\n    if (nodes.length) {\n      const { x, y } = position\n      const elements = document.elementsFromPoint(x, y)\n      const nodeViews = editor.getNodes().map(node => {\n        const view = area.nodeViews.get(node.id)\n\n        if (!view) throw new Error('view')\n\n        return {\n          node,\n          view\n        }\n      })\n\n      const intersectedNodes = elements\n        .map(el => nodeViews.find(item => item.view.element === el))\n        .filter((item): item is Exclude<typeof item, undefined> => Boolean(item))\n\n      const nonSelected = intersectedNodes\n        .filter(item => !item.node.selected)\n      const first = nonSelected[0]\n\n      if (first) {\n        first.view.element.style.opacity = '0.8'\n        previousHighlighted = first.node.id\n      }\n    }\n  }\n  // eslint-disable-next-line max-statements\n  scopes.addPipe(context => {\n    if (context.type === 'scopepicked') {\n      const { ids } = context.data\n\n      editor.getNodes().filter(n => !ids.includes(n.id)).forEach(node => {\n        const view = area.nodeViews.get(node.id)\n\n        if (view) view.element.style.opacity = '0.4'\n      })\n      if (clientPointerPostion) updateHighlightedScopes(clientPointerPostion, pickedNodes)\n    }\n    if (context.type === 'scopereleased') {\n      const { ids } = context.data\n\n      editor.getNodes().filter(n => !ids.includes(n.id)).forEach(node => {\n        const view = area.nodeViews.get(node.id)\n\n        if (view) view.element.style.opacity = ''\n      })\n      if (clientPointerPostion) updateHighlightedScopes(clientPointerPostion, pickedNodes)\n    }\n    if (context.type === 'pointermove') {\n      clientPointerPostion = {\n        x: context.data.event.clientX,\n        y: context.data.event.clientY\n      }\n      updateHighlightedScopes(clientPointerPostion, pickedNodes)\n    }\n    return context\n  })\n}\n","import { NodeEditor, NodeId, Root, Scope } from 'rete'\nimport { BaseArea, BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { useOrdering } from './ordering'\nimport { Preset } from './presets/types'\nimport { translateChildren } from './scope'\nimport { resizeParent } from './sizing'\nimport { ExpectedScheme, Padding, Size } from './types'\nimport { belongsTo, hasSelectedParent, trackedTranslate } from './utils'\nimport { useValidator } from './validation'\n\nexport * as Presets from './presets'\n\n/**\n * Props for `ScopesPlugin` class.\n */\nexport type Props = {\n  /** Padding (space) between the scope's border and its children. Default is `() => ({ top: 40, left: 20, right: 20, bottom: 20 })` */\n  padding?: (id: NodeId) => Padding\n  /** Determines whether the nested node should be excluded from affecting the scope's size, etc. Default is `() => false` */\n  exclude?: (id: NodeId) => boolean\n  /** Customizes the size of the node which is recognized as a parent. Default is `(id, size) => size` */\n  size?: (id: NodeId, size: Size) => Size\n}\n\ntype Requires<Schemes extends ExpectedScheme> =\n  | BaseArea<Schemes>\n\n/**\n * Signal types produced by ConnectionPlugin instance\n * @priority 10\n */\nexport type Scopes =\n  | { type: 'scopepicked', data: { ids: NodeId[] } }\n  | { type: 'scopereleased', data: { ids: NodeId[] } }\n\n/**\n * Scope plugin. Responsible for user interaction with scopes (nested nodes, groups)\n * @priority 9\n * @listens nodetranslated\n * @listens noderemoved\n * @emits scopepicked\n * @emits scopereleased\n */\nexport class ScopesPlugin<Schemes extends ExpectedScheme, T = never> extends Scope<Scopes, [Requires<Schemes>, Root<Schemes>]> {\n  padding: (id: NodeId) => Padding\n  exclude: (id: NodeId) => boolean\n  size: (id: NodeId, size: Size) => Size\n  editor!: NodeEditor<Schemes>\n  area!: BaseAreaPlugin<Schemes, T>\n  presets: Preset[] = []\n\n  constructor(props?: Props) {\n    super('scopes')\n    this.padding = props?.padding || (() => ({\n      top: 40,\n      left: 20,\n      right: 20,\n      bottom: 20\n    }))\n    this.exclude = props?.exclude || (() => false)\n    this.size = props?.size || ((id, size) => size)\n  }\n\n  // eslint-disable-next-line max-statements\n  setParent(scope: Scope<BaseArea<Schemes>, [Root<Schemes>]>): void {\n    super.setParent(scope)\n\n    this.area = this.parentScope<BaseAreaPlugin<Schemes, T>>(BaseAreaPlugin)\n    this.editor = this.area.parentScope<NodeEditor<Schemes>>(NodeEditor)\n\n    const props = { editor: this.editor, area: this.area }\n    const { padding, size, exclude } = this\n    const pickedNodes = getPickedNodes(this)\n    const { translate, isTranslating } = trackedTranslate(props)\n    const agentParams = { padding, size, exclude, translate }\n\n    useValidator(props)\n    useOrdering(props)\n\n    this.presets.forEach(preset => {\n      preset(agentParams, { ...props, scopes: this })\n    })\n\n    // eslint-disable-next-line max-statements, complexity\n    this.addPipe(async context => {\n      if (context.type === 'nodetranslated') {\n        const { id } = context.data\n        const current = props.editor.getNode(id)\n\n        if (!current) throw new Error('cannot find node')\n        // prevent translating children if the node translation\n        // is triggered by its resizing (when its children moved)\n        if (!isTranslating(id)) {\n          await translateChildren(id, context.data, props)\n        }\n\n        const parent = current.parent ? props.editor.getNode(current.parent) : null\n\n        if (parent && !agentParams.exclude(id)) {\n          const hasAnySelectedParent = hasSelectedParent(id, props)\n          const isPicked = belongsTo(current.id, pickedNodes, props)\n\n          if (!hasAnySelectedParent && !isPicked) {\n            await resizeParent(parent, agentParams, props)\n          }\n        }\n      }\n      if (context.type === 'noderemoved') {\n        const parentId = context.data.parent\n        const parent = parentId && props.editor.getNode(parentId)\n\n        if (parent) {\n          await resizeParent(parent, agentParams, props)\n        }\n      }\n      return context\n    })\n  }\n\n  /**\n   * Adds a preset to the plugin.\n   * @param preset Preset that is responsible for user interactions with scopes (e.g. assigning nodes to scopes)\n   */\n  public addPreset(preset: Preset) {\n    this.presets.push(preset)\n  }\n\n  public isDependent(id: NodeId) {\n    const props = { editor: this.editor, area: this.area }\n    const node = this.editor.getNode(id)\n\n    return node && (node.selected || hasSelectedParent(id, props))\n  }\n}\n\nexport function getPickedNodes<S extends ExpectedScheme>(scopes: Scope<Scopes, [Requires<S>, Root<S>]>) {\n  const nodes: NodeId[] = []\n\n  scopes.addPipe(async context => {\n    if (!('type' in context)) return context\n    if (context.type === 'scopepicked') {\n      nodes.push(...context.data.ids)\n    }\n    if (context.type === 'scopereleased') {\n      nodes.splice(0, nodes.length, ...nodes.filter(id => !context.data.ids.includes(id)))\n    }\n    return context\n  })\n  return nodes\n}\n","import { NodeEditor } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { ExpectedScheme } from './types'\nimport { watchClearing } from './utils'\n\ntype Props<T> = { editor: NodeEditor<ExpectedScheme>, area: BaseAreaPlugin<ExpectedScheme, T> }\n\nexport function useValidator<T>(props: Props<T>) {\n  const isClearing = watchClearing(props.editor)\n\n  // eslint-disable-next-line max-statements\n  props.area.addPipe(context => {\n    if (!context || !(typeof context === 'object' && 'type' in context)) return context\n    if (context.type === 'nodecreate') {\n      const parentId = context.data.parent\n\n      if (parentId) {\n        const parent = props.editor.getNodes().find(n => n.id === parentId)\n\n        if (!parent) throw new Error('parent node doesnt exist')\n      }\n    }\n    if (context.type === 'noderemove' && !isClearing()) {\n      const { id } = context.data\n\n      const child = props.editor.getNodes().find(n => n.parent === id)\n\n      if (child) throw new Error('cannot remove parent node with a children')\n    }\n    return context\n  })\n}\n"],"names":["bringConnectionBack","id","props","view","area","connectionViews","get","content","reorder","element","holder","firstChild","bringForward","nodeId","nodeViews","connections","editor","getConnections","filter","c","source","target","children","getNodes","n","parent","forEach","connection","bringConnectionForward","child","getNodesBoundingBox","nodes","_ref","boxes","map","node","Error","position","width","height","left","Math","min","apply","_toConsumableArray","b","x","right","max","top","y","bottom","updateNodeSizes","size","_ref2","resize","resizeParent","_x","_x2","_x3","_resizeParent","this","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","agentParams","padding","_getNodesBoundingBox","outerWidth","outerHeight","outerTop","outerLeft","parentsParent","wrap","_context","prev","next","exclude","length","translate","getNode","stop","reassignParent","_x4","_reassignParent","ids","pointer","overlayNodes","areaElements","overlayNodesWithIndex","topOverlayParent","formerParents","_iterator","_step","formerParent","abrupt","Boolean","includes","Array","from","childNodes","_ref3","index","indexOf","sort","a","undefined","_createForOfIteratorHelper","s","done","value","t0","e","f","finish","translateChildren","_x5","_x6","_x7","_translateChildren","_callee3","previous","_context3","Promise","all","_ref4","_callee2","dx","dy","nodePosition","_context2","selected","_x8","belongsTo","hasSelectedParent","params","context","scopes","timeout","picked","candidates","cancel","window","clearTimeout","pick","timeoutId","setTimeout","_candidates","targets","push","emit","type","data","addPipe","list","classic","pickedNodes","getPickedNodes","previousHighlighted","clientPointerPostion","updateHighlightedScopes","style","opacity","elements","document","elementsFromPoint","first","el","find","item","event","clientX","clientY","ScopesPlugin","_Scope","_inherits","_super","_createSuper","_this","_classCallCheck","_defineProperty","_assertThisInitialized","call","key","scope","_this2","_get","_getPrototypeOf","prototype","parentScope","BaseAreaPlugin","NodeEditor","_trackedTranslate","active","Map","increment","set","decrement","isTranslating","trackedTranslate","state","isClearing","_typeof","parentId","useValidator","getConnection","useOrdering","presets","preset","_objectSpread","_id","current","hasAnySelectedParent","isPicked","_parent","Scope","splice","concat"],"mappings":";;;;;2nWAeA,SAASA,EAAuBC,EAAkBC,GAChD,IAAMC,EAAOD,EAAME,KAAKC,gBAAgBC,IAAIL,GACpCM,EAAYL,EAAME,KAAKA,KAAvBG,QAEJJ,GACFI,EAAQC,QAAQL,EAAKM,QAASF,EAAQG,OAAOC,WAEjD,CAEA,SAASC,EAAgBC,EAAgBX,GACvC,IAAMC,EAAOD,EAAME,KAAKU,UAAUR,IAAIO,GAChCE,EAAcb,EAAMc,OAAOC,iBAAiBC,QAAO,SAAAC,GACvD,OAAON,IAAWM,EAAEC,QAAUP,IAAWM,EAAEE,MAC7C,IACMC,EAAWpB,EAAMc,OAAOO,WAAWL,QAAO,SAAAM,GAC9C,OAAOA,EAAEC,SAAWZ,CACtB,IAEAE,EAAYW,SAAQ,SAAAC,GAAU,OA1BhC,SAAmC1B,EAAkBC,GACnD,IAAMC,EAAOD,EAAME,KAAKC,gBAAgBC,IAAIL,GAExCE,GACFD,EAAME,KAAKA,KAAKG,QAAQC,QAAQL,EAAKM,QAAS,KAElD,CAoBoCmB,CAAuBD,EAAW1B,GAAIC,MAEpEC,GACFD,EAAME,KAAKA,KAAKG,QAAQC,QAAQL,EAAKM,QAAS,MAGhDa,EAASI,SAAQ,SAAAG,GAAK,OAAIjB,EAAaiB,EAAM5B,GAAIC,KACnD,CChCO,SAAS4B,EAAuBC,EAA+BC,GAAsB,IAAlB5B,EAAI4B,EAAJ5B,KAClE6B,EAAQF,EAAMG,KAAI,SAAAC,GACtB,IAAMhC,EAAOC,EAAKU,UAAUR,IAAI6B,EAAKlC,IAErC,IAAKE,EAAM,MAAM,IAAIiC,MAAM,QAE3B,MAAO,CACLC,SAAUlC,EAAKkC,SACfC,MAAOH,EAAKG,MACZC,OAAQJ,EAAKI,OAEjB,IAEMC,EAAOC,KAAKC,IAAGC,MAARF,KAAIG,EAAQX,EAAMC,KAAI,SAAAW,GAAC,OAAIA,EAAER,SAASS,CAAC,MAC9CC,EAAQN,KAAKO,IAAGL,MAARF,KAAIG,EAAQX,EAAMC,KAAI,SAAAW,GAAC,OAAIA,EAAER,SAASS,EAAID,EAAEP,KAAK,MACzDW,EAAMR,KAAKC,IAAGC,MAARF,KAAIG,EAAQX,EAAMC,KAAI,SAAAW,GAAC,OAAIA,EAAER,SAASa,CAAC,MAC7CC,EAASV,KAAKO,IAAGL,MAARF,KAAIG,EAAQX,EAAMC,KAAI,SAAAW,GAAC,OAAIA,EAAER,SAASa,EAAIL,EAAEN,MAAM,MAIjE,MAAO,CACLU,IAAAA,EACAT,KAAAA,EACAO,MAAAA,EACAI,OAAAA,EACAb,MARYS,EAAQP,EASpBD,OARaY,EAASF,EAU1B,CAIO,SAASG,EAAmBjB,EAA8BkB,EAAUC,GAAsB,IAAlBlD,EAAIkD,EAAJlD,KACrEkC,EAAkBe,EAAlBf,MAAOC,EAAWc,EAAXd,OAEfJ,EAAKG,MAAQA,EACbH,EAAKI,OAASA,EAEdnC,EAAKmD,OAAOpB,EAAKlC,GAAIqC,EAAOC,EAC9B,CAGA,SAAsBiB,EAAYC,EAAAC,EAAAC,GAAA,OAAAC,EAAAjB,MAAAkB,KAAAC,UAAA,CAgCjC,SAAAF,IAAA,OAAAA,EAAAG,EAAAC,IAAAC,MAhCM,SAAAC,EAA+BzC,EAAgC0C,EAA0BjE,GAAe,IAAAD,EAAAqB,EAAA8C,EAAAf,EAAAgB,EAAApB,EAAAT,EAAAF,EAAAC,EAAA+B,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAV,IAAAW,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAKtE,GAJ/B7E,EAAOwB,EAAPxB,GACFqB,EAAWpB,EAAMc,OAAOO,WAC3BL,QAAO,SAAAW,GAAK,OAAIA,EAAMJ,SAAWxB,CAAE,IACnCiB,QAAO,SAAAiB,GAAI,OAAKgC,EAAYY,QAAQ5C,EAAKlC,OACtCmE,EAAUD,EAAYC,QAAQnE,GAEZ,IAApBqB,EAAS0D,OAAY,CAAAJ,EAAAE,KAAA,EAAA,KAAA,CACjBzB,EAAOc,EAAYd,KAAKpD,EAAI,CAChCqC,MAAO8B,EAAQ5B,KAAO4B,EAAQrB,MAC9BR,OAAQ6B,EAAQnB,IAAMmB,EAAQjB,SAGhCC,EAAgB3B,EAAQ4B,EAAMnD,GAAM0E,EAAAE,KAAA,GAAA,MAAA,KAAA,EAS4D,OAT5DT,EAECvC,EAAoBR,EAAUpB,GAA3D+C,EAAGoB,EAAHpB,IAAKT,EAAI6B,EAAJ7B,KAAMF,EAAK+B,EAAL/B,MAAOC,EAAM8B,EAAN9B,OAEpB+B,EAAahC,EAAQ8B,EAAQ5B,KAAO4B,EAAQrB,MAC5CwB,EAAchC,EAAS6B,EAAQnB,IAAMmB,EAAQjB,OAC7CqB,EAAWvB,EAAMmB,EAAQnB,IACzBwB,EAAYjC,EAAO4B,EAAQ5B,KAEjCY,EAAgB3B,EAAQ0C,EAAYd,KAAKpD,EAAI,CAAEqC,MAAOgC,EAAY/B,OAAQgC,IAAgBrE,GAAM0E,EAAAE,KAAA,GAC1FX,EAAYc,UAAUxD,EAAOxB,GAAIwE,EAAWD,GAAS,KAAA,GAAA,IAEzD/C,EAAOA,OAAM,CAAAmD,EAAAE,KAAA,GAAA,KAAA,CAC0C,KAAnDJ,EAAgBxE,EAAMc,OAAOkE,QAAQzD,EAAOA,SAEjC,CAAAmD,EAAAE,KAAA,GAAA,KAAA,CAAA,OAAAF,EAAAE,KAAA,GACTtB,EAAakB,EAAeP,EAAajE,GAAM,KAAA,GAAA,IAAA,MAAA,OAAA0E,EAAAO,OAAA,GAAAjB,EAG1D,MAAAvB,MAAAkB,KAAAC,UAAA,CCxEqBsB,SAAAA,EAAc3B,EAAAC,EAAAC,EAAA0B,GAAA,OAAAC,EAAA3C,MAAAkB,KAAAC,UAAA,CAmDnC,SAAAwB,IAAA,OAAAA,EAAAvB,EAAAC,IAAAC,MAnDM,SAAAC,EAAiCqB,EAAeC,EAAmCrB,EAA0BjE,GAAe,IAAA6B,EAAA0D,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAAhC,IAAAW,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GAC5HS,EAAIP,OAAM,CAAAJ,EAAAE,KAAA,EAAA,KAAA,CAAA,OAAAF,EAAAqB,OAAA,UAAA,KAAA,EAyC+B,GAxCxClE,EAAQwD,EACXrD,KAAI,SAAAjC,GAAE,OAAIC,EAAMc,OAAOkE,QAAQjF,EAAG,IAClCiB,QAAO,SAACM,GAAC,OAAkC0E,QAAQ1E,MAEhDiE,EAAevF,EAAMc,OAAOO,WAC/BW,KAAI,SAAAC,GACH,IAAMhC,EAAOD,EAAME,KAAKU,UAAUR,IAAI6B,EAAKlC,IAE3C,IAAKE,EAAM,MAAM,IAAIiC,MAAM,aAE3B,MAAO,CAAED,KAAAA,EAAMhC,KAAAA,EACjB,IAAGe,QAAO,SAAAoC,GAAoB,IAAjBnB,EAAImB,EAAJnB,KAAMhC,EAAImD,EAAJnD,KACjB,OAAQoF,EAAIY,SAAShE,EAAKlC,KACrBuF,EAAQ1C,EAAI3C,EAAKkC,SAASS,GAC1B0C,EAAQtC,EAAI/C,EAAKkC,SAASa,GAC1BsC,EAAQ1C,EAAI3C,EAAKkC,SAASS,EAAIX,EAAKG,OACnCkD,EAAQtC,EAAI/C,EAAKkC,SAASa,EAAIf,EAAKI,MAC1C,IACImD,EAAeU,MAAMC,KAAKnG,EAAME,KAAKA,KAAKG,QAAQG,OAAO4F,aACzDX,EAAwBF,EAAavD,KAAI,SAAAqE,GAAoB,IAAjBpE,EAAIoE,EAAJpE,KAAMhC,EAAIoG,EAAJpG,KAGtD,MAAO,CAAEgC,KAAAA,EAAMhC,KAAAA,EAAMqG,MAFPd,EAAae,QAAQtG,EAAKM,SAG1C,KAEsBiG,MAAK,SAACC,EAAG9D,GAAC,OAAKA,EAAE2D,MAAQG,EAAEH,SAC3CZ,EAAmBD,EAAsB,GAEzCE,EAAgB9D,EACnBG,KAAI,SAAAC,GAAI,OAAIA,EAAKV,MAAM,IACvBP,QAAO,SAACjB,GAAE,OAAmBiG,QAAQjG,EAAG,IACxCiC,KAAI,SAAAjC,GACH,IAAMkC,EAAOjC,EAAMc,OAAOkE,QAAQjF,GAElC,IAAKkC,EAAM,MAAM,IAAIC,MAAM,QAE3B,OAAOD,CACT,IAGFJ,EAAML,SAAQ,SAAAS,GAAI,OAAIA,EAAKV,YAASmF,MAChChB,EAAgB,CAAAhB,EAAAE,KAAA,GAAA,KAAA,CAC2C,OAA7D/C,EAAML,SAAQ,SAAAS,GAAI,OAAIA,EAAKV,OAASmE,EAAiBzD,KAAKlC,MAAG2E,EAAAE,KAAA,GACvDtB,EAAaoC,EAAiBzD,KAAMgC,EAAajE,GAAM,KAAA,GAAA4F,EAAAe,EAGpChB,GAAajB,EAAAC,KAAA,GAAAiB,EAAAgB,IAAA,KAAA,GAAA,IAAAf,EAAAD,EAAAtE,KAAAuF,KAAA,CAAAnC,EAAAE,KAAA,GAAA,KAAA,CAAjB,OAAZkB,EAAYD,EAAAiB,MAAApC,EAAAE,KAAA,GACftB,EAAawC,EAAc7B,EAAajE,GAAM,KAAA,GAAA0E,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAAF,EAAAC,KAAA,GAAAD,EAAAqC,GAAArC,EAAA,MAAA,IAAAkB,EAAAoB,EAAAtC,EAAAqC,IAAA,KAAA,GAAA,OAAArC,EAAAC,KAAA,GAAAiB,EAAAqB,IAAAvC,EAAAwC,OAAA,IAAA,KAAA,GAAA,IAAA,MAAA,OAAAxC,EAAAO,OAAA,GAAAjB,EAAA,KAAA,CAAA,CAAA,GAAA,GAAA,GAAA,KAEvD,MAAAvB,MAAAkB,KAAAC,UAAA,CAED,SAAsBuD,EAAiBC,EAAAC,EAAAC,GAAA,OAAAC,EAAA9E,MAAAkB,KAAAC,UAAA,CAgBtC,SAAA2D,IAAA,OAAAA,EAAA1D,EAAAC,IAAAC,MAhBM,SAAAyD,EAAoCzH,EAAU+B,EAAsE9B,GAAe,IAAAmC,EAAAsF,EAAArG,EAAA,OAAA0C,IAAAW,MAAA,SAAAiD,GAAA,cAAAA,EAAA/C,KAAA+C,EAAA9C,MAAA,KAAA,EACnE,OADdzC,EAAQL,EAARK,SAAUsF,EAAQ3F,EAAR2F,SAC3DrG,EAAWpB,EAAMc,OAAOO,WAAWL,QAAO,SAAAM,GAAC,OAAIA,EAAEC,SAAWxB,KAAG2H,EAAA9C,KAAA,EAE/D+C,QAAQC,IAAIxG,EAASY,IAAG,WAAA,IAAA6F,EAAAhE,EAAAC,IAAAC,MAAC,SAAA+D,EAAMxG,GAAC,IAAAyG,EAAAC,EAAA/H,EAAAgC,EAAAgG,EAAA,OAAAnE,IAAAW,MAAA,SAAAyD,GAAA,cAAAA,EAAAvD,KAAAuD,EAAAtD,MAAA,KAAA,EAKG,GAJjCmD,EAAK5F,EAASS,EAAI6E,EAAS7E,EAC3BoF,EAAK7F,EAASa,EAAIyE,EAASzE,EAE3B/C,EAAOD,EAAME,KAAKU,UAAUR,IAAIkB,EAAEvB,IAClCkC,EAAOjC,EAAMc,OAAOkE,QAAQ1D,EAAEvB,KAEhCE,IAAQgC,GAASA,EAAKkG,SAAQ,CAAAD,EAAAtD,KAAA,EAAA,KAAA,CACE,OAA5BqD,EAAehI,EAAKkC,SAAQ+F,EAAAtD,KAAA,EAE5B3E,EAAK8E,UAAUkD,EAAarF,EAAImF,EAAIE,EAAajF,EAAIgF,GAAG,KAAA,EAAA,IAAA,MAAA,OAAAE,EAAAjD,OAAA,GAAA6C,EAEjE,KAAA,OAAA,SAAAM,GAAA,OAAAP,EAAApF,MAAAkB,KAAAC,UAAA,CAAA,CAZ6B,KAY3B,KAAA,EAAA,IAAA,MAAA,OAAA8D,EAAAzC,OAAA,GAAAuC,EACJ,KAAAD,EAAA9E,MAAAkB,KAAAC,UAAA,CCxEM,SAASyE,EAAa1H,EAAgB0E,EAAerF,GAC1D,IAAMiC,EAAOjC,EAAMc,OAAOkE,QAAQrE,GAElC,IAAKsB,EAAM,MAAM,IAAIC,MAAM,QAE3B,QAAImD,EAAIY,SAAStF,MACZsB,EAAKV,WACN8G,EAAUpG,EAAKV,OAAQ8D,EAAKrF,SAAhC,EACF,CAEO,SAASsI,EAAqB3H,EAAgBX,GACnD,IAAMiC,EAAOjC,EAAMc,OAAOkE,QAAQrE,GAElC,IAAKsB,EAAM,MAAM,IAAIC,MAAM,QAE3B,IAAKD,EAAKV,OAAQ,OAAO,EAEzB,IAAMA,EAASvB,EAAMc,OAAOkE,QAAQ/C,EAAKV,QAEzC,IAAKA,EAAQ,MAAM,IAAIW,MAAM,QAE7B,QAAIX,EAAO4G,UAEJG,EAAkBrG,EAAKV,OAAQvB,EACxC,2CCnBO,WACL,OAAO,SAACuI,EAAQC,ICFuB,SAACD,EAAgCzG,GAA+B,IAA3B5B,EAAI4B,EAAJ5B,KAAMY,EAAMgB,EAANhB,OAAQ2H,EAAM3G,EAAN2G,OACpFC,EAAUH,EAAOG,SAAW,IAE9BC,EAAqC,KACrCC,EAAuB,GAE3B,SAASC,IACHF,IACFG,OAAOC,aAAaJ,EAAOD,SAC3BC,EAAS,KAEb,CAEA,SAASK,EAAKjJ,GACZ,IAAMkJ,EAAYH,OAAOI,YAAW,WAAM,IAAAC,EAClChB,EAAWrH,EAAOO,WAAWL,QAAO,SAAAM,GAAC,OAAIA,EAAE6G,YAC3CiB,EAAUjB,EAASrD,OAASqD,EAASnG,KAAI,SAAAV,GAAC,OAAIA,EAAEvB,MAAM,CAACA,IAE7DoJ,EAAAP,GAAWS,KAAI5G,MAAA0G,EAAAzG,EAAI0G,IACnBX,EAAOa,KAAK,CAAEC,KAAM,cAAeC,KAAM,CAAEnE,IAAK+D,IACjD,GAAEV,GAEHC,EAAS,CAAED,QAASO,EACtB,CAYA/I,EAAKuJ,QAAO,WAAA,IAAArG,EAAAS,EAAAC,IAAAC,MAAC,SAAAC,EAAMwE,GAAO,IAAAlD,EAAAD,EAAA,OAAAvB,IAAAW,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GAClB,SAAU4D,EAAO,CAAA9D,EAAAE,KAAA,EAAA,KAAA,CAAA,OAAAF,EAAAqB,OAAA,SAAUyC,GAAO,KAAA,EAMvC,GALoB,eAAjBA,EAAQe,MACVP,EAAKR,EAAQgB,KAAKzJ,IAEC,mBAAjByI,EAAQe,MACVV,IAEmB,gBAAjBL,EAAQe,KAAsB,CAAA7E,EAAAE,KAAA,EAAA,KAAA,CAEX,OADbU,EAAYpF,EAAKA,KAAjBoF,QAnBJoE,WAAIhH,EAAOkG,GAEjBC,IACAD,EAAa,GAEbH,EAAOa,KAAK,CAAEC,KAAM,gBAAiBC,KAAM,CAAEnE,IAAKqE,KAe1CrE,EAbDqE,EAagBhF,EAAAE,KAAA,EAEfM,EAAeG,EAAKC,EAASiD,EAAQ,CAAErI,KAAAA,EAAMY,OAAAA,IAAS,KAAA,EAAA,OAAA4D,EAAAqB,OAAA,SAEvDyC,GAAO,KAAA,GAAA,IAAA,MAAA,OAAA9D,EAAAO,OAzBhB,IACQyE,CAwBQ,GAAA1F,EACf,KAAA,OAAA,SAAAT,GAAA,OAAAH,EAAAX,MAAAkB,KAAAC,UAAA,CAAC,CAfU,GAgBd,CDhDI+F,CAAsBpB,EAAQC,GCkD3B,SAAyBnC,GAAqD,IAA/CnG,EAAImG,EAAJnG,KAAMY,EAAMuF,EAANvF,OAAQ2H,EAAMpC,EAANoC,OAC5CmB,EAAcC,EAAepB,GAC/BqB,EAAqC,KACrCC,EAAwC,KAG5C,SAASC,EAAwB7H,EAAoCN,GACnE,GAAIiI,EAAqB,CACvB,IAAM7J,EAAOC,EAAKU,UAAUR,IAAI0J,GAE5B7J,GAAQ4B,EAAMiD,SAAQ7E,EAAKM,QAAQ0J,MAAMC,QAAU,OACvDJ,EAAsB,IACxB,CACA,GAAIjI,EAAMiD,OAAQ,CAChB,IAAQlC,EAAST,EAATS,EAAGI,EAAMb,EAANa,EACLmH,EAAWC,SAASC,kBAAkBzH,EAAGI,GACzCpC,EAAYE,EAAOO,WAAWW,KAAI,SAAAC,GACtC,IAAMhC,EAAOC,EAAKU,UAAUR,IAAI6B,EAAKlC,IAErC,IAAKE,EAAM,MAAM,IAAIiC,MAAM,QAE3B,MAAO,CACLD,KAAAA,EACAhC,KAAAA,EAEJ,IAQMqK,EANmBH,EACtBnI,KAAI,SAAAuI,GAAE,OAAI3J,EAAU4J,MAAK,SAAAC,GAAI,OAAIA,EAAKxK,KAAKM,UAAYgK,IAAG,IAC1DvJ,QAAO,SAACyJ,GAAI,OAA8CzE,QAAQyE,MAGlEzJ,QAAO,SAAAyJ,GAAI,OAAKA,EAAKxI,KAAKkG,YACH,GAEtBmC,IACFA,EAAMrK,KAAKM,QAAQ0J,MAAMC,QAAU,MACnCJ,EAAsBQ,EAAMrI,KAAKlC,GAErC,CACF,CAEA0I,EAAOgB,SAAQ,SAAAjB,GACb,GAAqB,gBAAjBA,EAAQe,KAAwB,CAClC,IAAQlE,EAAQmD,EAAQgB,KAAhBnE,IAERvE,EAAOO,WAAWL,QAAO,SAAAM,GAAC,OAAK+D,EAAIY,SAAS3E,EAAEvB,GAAG,IAAEyB,SAAQ,SAAAS,GACzD,IAAMhC,EAAOC,EAAKU,UAAUR,IAAI6B,EAAKlC,IAEjCE,IAAMA,EAAKM,QAAQ0J,MAAMC,QAAU,MACzC,IACIH,GAAsBC,EAAwBD,EAAsBH,EAC1E,CACA,GAAqB,kBAAjBpB,EAAQe,KAA0B,CACpC,IAAQlE,EAAQmD,EAAQgB,KAAhBnE,IAERvE,EAAOO,WAAWL,QAAO,SAAAM,GAAC,OAAK+D,EAAIY,SAAS3E,EAAEvB,GAAG,IAAEyB,SAAQ,SAAAS,GACzD,IAAMhC,EAAOC,EAAKU,UAAUR,IAAI6B,EAAKlC,IAEjCE,IAAMA,EAAKM,QAAQ0J,MAAMC,QAAU,GACzC,IACIH,GAAsBC,EAAwBD,EAAsBH,EAC1E,CAQA,MAPqB,gBAAjBpB,EAAQe,MAKVS,EAJAD,EAAuB,CACrBnH,EAAG4F,EAAQgB,KAAKkB,MAAMC,QACtB3H,EAAGwF,EAAQgB,KAAKkB,MAAME,SAEsBhB,GAEzCpB,CACT,GACF,CDzHImB,CAAyBnB,GAE7B,gDE2BaqC,WAAYC,yRAAAC,CAAAF,EAAAC,GAAA,UAAAE,EAAAC,EAAAJ,GAQvB,SAAAA,EAAY7K,GAAe,IAAAkL,EASsB,mGATtBC,MAAAN,GACVO,EAAAC,EAAfH,EAAAF,EAAAM,UAAM,qBAHY,IAIlBJ,EAAKhH,SAAUlE,aAAAA,EAAAA,EAAOkE,UAAY,WAAA,MAAO,CACvCnB,IAAK,GACLT,KAAM,GACNO,MAAO,GACPI,OAAQ,KAEViI,EAAKrG,SAAU7E,aAAAA,EAAAA,EAAO6E,UAAY,WAAA,OAAM,GACxCqG,EAAK/H,MAAOnD,aAAAA,EAAAA,EAAOmD,OAAS,SAACpD,EAAIoD,GAAI,OAAKA,GAAK+H,CACjD,CAuEC,SArEDL,IAAA,CAAA,CAAAU,IAAA,YAAAzE,MACA,SAAU0E,GAAwD,IAAAC,EAAA9H,KAChE+H,EAAAC,EAAAd,EAAAe,WAAA,YAAAjI,MAAA2H,KAAA3H,KAAgB6H,GAEhB7H,KAAKzD,KAAOyD,KAAKkI,YAAwCC,EAAcA,gBACvEnI,KAAK7C,OAAS6C,KAAKzD,KAAK2L,YAAiCE,EAAUA,YAEnE,IAAM/L,EAAQ,CAAEc,OAAQ6C,KAAK7C,OAAQZ,KAAMyD,KAAKzD,MACxCgE,EAA2BP,KAA3BO,QAASf,EAAkBQ,KAAlBR,KAAM0B,EAAYlB,KAAZkB,QACjB+E,EAAcC,EAAelG,MACnCqI,EHpCG,SAA6BhM,GAIlC,IAAMiM,EAAS,IAAIC,IACbC,EAAY,SAACpM,GAAU,OAAKkM,EAAOG,IAAIrM,GAAKkM,EAAO7L,IAAIL,IAAO,GAAK,EAAE,EACrEsM,EAAY,SAACtM,GAAU,OAAKkM,EAAOG,IAAIrM,GAAKkM,EAAO7L,IAAIL,IAAO,GAAK,EAAE,EAE3E,MAAO,CACCgF,mBAAUhF,EAAI6C,EAAGI,GAAG,OAAAa,EAAAC,IAAAC,eAAAC,IAAA,IAAA/D,EAAAwH,EAAA,OAAA3D,IAAAW,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EACiB,GAAnC3E,EAAOD,EAAME,KAAKU,UAAUR,IAAIL,GAE7B,CAAA2E,EAAAE,KAAA,EAAA,KAAA,CAAA,MAAQ,IAAI1C,MAAM,gCAA+B,KAAA,EAE5B,IAAxBuF,EAAWxH,EAAKkC,UAETS,IAAMA,GAAK6E,EAASzE,IAAMA,EAAC,CAAA0B,EAAAE,KAAA,EAAA,KAAA,CACzB,OAAbuH,EAAUpM,GAAG2E,EAAAE,KAAA,EACP3E,EAAK8E,UAAUnC,EAAGI,GAAE,KAAA,EAC1BqJ,EAAUtM,GAAG,KAAA,EAAA,IAAA,MAAA,OAAA2E,EAAAO,OAAA,GAAAjB,EAAA,IAVSH,EAYzB,EACDyI,cAAa,SAACvM,GACZ,OAAQkM,EAAO7L,IAAIL,IAAO,GAAK,CACjC,EAEJ,CGUyCwM,CAAiBvM,GAA9C+E,EAASiH,EAATjH,UAAWuH,EAAaN,EAAbM,cACbrI,EAAc,CAAEC,QAAAA,EAASf,KAAAA,EAAM0B,QAAAA,EAASE,UAAAA,ICnE3C,SAAyB/E,GAC9B,IJyD4Bc,EACxB0L,EI1DEC,GJyDsB3L,EIzDKd,EAAMc,OJ0DnC0L,GAAQ,EAEZ1L,EAAO2I,SAAQ,SAAAjB,GAOb,MANqB,UAAjBA,EAAQe,OACViD,GAAQ,GAEW,YAAjBhE,EAAQe,MAAuC,mBAAjBf,EAAQe,OACxCiD,GAAQ,GAEHhE,CACT,IAEO,WAAA,OAAMgE,CAAK,GInElBxM,EAAME,KAAKuJ,SAAQ,SAAAjB,GACjB,IAAKA,GAAgC,WAAnBkE,EAAOlE,MAAwB,SAAUA,GAAU,OAAOA,EAC5E,GAAqB,eAAjBA,EAAQe,KAAuB,CACjC,IAAMoD,EAAWnE,EAAQgB,KAAKjI,OAE9B,GAAIoL,IACa3M,EAAMc,OAAOO,WAAWmJ,MAAK,SAAAlJ,GAAC,OAAIA,EAAEvB,KAAO4M,KAE7C,MAAM,IAAIzK,MAAM,2BAEjC,CACA,GAAqB,eAAjBsG,EAAQe,OAA0BkD,IAAc,CAClD,IAAQ1M,EAAOyI,EAAQgB,KAAfzJ,GAIR,GAFcC,EAAMc,OAAOO,WAAWmJ,MAAK,SAAAlJ,GAAC,OAAIA,EAAEC,SAAWxB,KAElD,MAAM,IAAImC,MAAM,4CAC7B,CACA,OAAOsG,CACT,GACF,CD6CIoE,CAAa5M,GNnCV,SAAwBA,GAE7BA,EAAME,KAAKuJ,QAAO,WAAA,IAAA3H,EAAA+B,EAAAC,IAAAC,MAAC,SAAAC,EAAMwE,GAAO,IAAAzI,EAAA0B,EAAA,OAAAqC,IAAAW,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GACxB,SAAU4D,EAAO,CAAA9D,EAAAE,KAAA,EAAA,KAAA,CAAA,OAAAF,EAAAqB,OAAA,SAAUyC,GAAO,KAAA,EAGvC,GAFoB,eAAjBA,EAAQe,MACV7I,EAAa8H,EAAQgB,KAAKzJ,GAAIC,GAEX,sBAAjBwI,EAAQe,KAA4B,CAAA7E,EAAAE,KAAA,GAAA,KAAA,CAEW,GADzC7E,EAAOyI,EAAQgB,KAAfzJ,GACF0B,EAAazB,EAAMc,OAAO+L,cAAc9M,GAE/B,CAAA2E,EAAAE,KAAA,EAAA,KAAA,CAAA,MAAQ,IAAI1C,MAAM,0BAAyB,KAAA,EAC1DpC,EAAoB0I,EAAQgB,KAAKzJ,GAAIC,GACrCU,EAAae,EAAWP,OAAQlB,GAChCU,EAAae,EAAWN,OAAQnB,GAAM,KAAA,GAAA,OAAA0E,EAAAqB,OAAA,SAEjCyC,GAAO,KAAA,GAAA,IAAA,MAAA,OAAA9D,EAAAO,OAAA,GAAAjB,EACf,KAAA,OAAA,SAAAT,GAAA,OAAAzB,EAAAW,MAAAkB,KAAAC,UAAA,CAAC,CAfgB,GAgBpB,CMkBIkJ,CAAY9M,GAEZ2D,KAAKoJ,QAAQvL,SAAQ,SAAAwL,GACnBA,EAAO/I,EAAWgJ,EAAAA,KAAOjN,GAAK,GAAA,CAAEyI,OAAQgD,IAC1C,IAGA9H,KAAK8F,QAAO,WAAA,IAAA3H,EAAA+B,EAAAC,IAAAC,MAAC,SAAAC,EAAMwE,GAAO,IAAA0E,EAAAC,EAAA5L,EAAA6L,EAAAC,EAAAV,EAAAW,EAAA,OAAAxJ,IAAAW,MAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GACH,mBAAjB4D,EAAQe,KAAyB,CAAA7E,EAAAE,KAAA,GAAA,KAAA,CAEK,GADhC7E,EAAOyI,EAAQgB,KAAfzJ,GACFoN,EAAUnN,EAAMc,OAAOkE,QAAQjF,GAEzB,CAAA2E,EAAAE,KAAA,EAAA,KAAA,CAAA,MAAQ,IAAI1C,MAAM,oBAAmB,KAAA,EAAA,GAG5CoK,EAAcvM,GAAG,CAAA2E,EAAAE,KAAA,EAAA,KAAA,CAAA,OAAAF,EAAAE,KAAA,EACduC,EAAkBpH,EAAIyI,EAAQgB,KAAMxJ,GAAM,KAAA,EAGyB,KAArEuB,EAAS4L,EAAQ5L,OAASvB,EAAMc,OAAOkE,QAAQmI,EAAQ5L,QAAU,OAExD0C,EAAYY,QAAQ9E,GAAG,CAAA2E,EAAAE,KAAA,GAAA,KAAA,CAEsB,GADpDwI,EAAuB9E,EAAkBvI,EAAIC,GAC7CqN,EAAWhF,EAAU8E,EAAQpN,GAAI6J,EAAa5J,GAE/CoN,GAAyBC,EAAQ,CAAA3I,EAAAE,KAAA,GAAA,KAAA,CAAA,OAAAF,EAAAE,KAAA,GAC9BtB,EAAa/B,EAAQ0C,EAAajE,GAAM,KAAA,GAAA,GAI/B,gBAAjBwI,EAAQe,KAAsB,CAAA7E,EAAAE,KAAA,GAAA,KAAA,CAEyB,GADnD+H,EAAWnE,EAAQgB,KAAKjI,SACxBA,EAASoL,GAAY3M,EAAMc,OAAOkE,QAAQ2H,IAEtC,CAAAjI,EAAAE,KAAA,GAAA,KAAA,CAAA,OAAAF,EAAAE,KAAA,GACFtB,EAAa/B,EAAQ0C,EAAajE,GAAM,KAAA,GAAA,OAAA0E,EAAAqB,OAAA,SAG3CyC,GAAO,KAAA,GAAA,IAAA,MAAA,OAAA9D,EAAAO,OAAA,GAAAjB,EACf,KAAA,OAAA,SAAAT,GAAA,OAAAzB,EAAAW,MAAAkB,KAAAC,UAAA,CAAC,CAhCU,GAiCd,GAEA,CAAA2H,IAAA,YAAAzE,MAIA,SAAiBkG,GACfrJ,KAAKoJ,QAAQ1D,KAAK2D,EACpB,GAAC,CAAAzB,IAAA,cAAAzE,MAED,SAAmB/G,GACjB,IAAMC,EAAQ,CAAEc,OAAQ6C,KAAK7C,OAAQZ,KAAMyD,KAAKzD,MAC1C+B,EAAO0B,KAAK7C,OAAOkE,QAAQjF,GAEjC,OAAOkC,IAASA,EAAKkG,UAAYG,EAAkBvI,EAAIC,GACzD,qFAAC6K,CAAA,EAzF0E0C,SA4FtE,SAAS1D,EAAyCpB,GACvD,IAAM5G,EAAkB,GAYxB,OAVA4G,EAAOgB,QAAO,WAAA,IAAArG,EAAAS,EAAAC,IAAAC,MAAC,SAAA+D,EAAMU,GAAO,OAAA1E,IAAAW,MAAA,SAAAyD,GAAA,cAAAA,EAAAvD,KAAAuD,EAAAtD,MAAA,KAAA,EAAA,GACpB,SAAU4D,EAAO,CAAAN,EAAAtD,KAAA,EAAA,KAAA,CAAA,OAAAsD,EAAAnC,OAAA,SAAUyC,GAAO,KAAA,EAMvC,MALoB,gBAAjBA,EAAQe,MACV1H,EAAMwH,KAAI5G,MAAVZ,EAAKa,EAAS8F,EAAQgB,KAAKnE,MAER,kBAAjBmD,EAAQe,MACV1H,EAAM2L,OAAM/K,MAAZZ,EAAK,CAAQ,EAAGA,EAAMiD,QAAM2I,OAAA/K,EAAKb,EAAMb,QAAO,SAAAjB,GAAE,OAAKyI,EAAQgB,KAAKnE,IAAIY,SAASlG,EAAG,OACnFmI,EAAAnC,OAAA,SACMyC,GAAO,KAAA,EAAA,IAAA,MAAA,OAAAN,EAAAjD,OAAA,GAAA6C,EACf,KAAA,OAAA,SAAAtE,GAAA,OAAAJ,EAAAX,MAAAkB,KAAAC,UAAA,CAAC,CATY,IAUP/B,CACT"}