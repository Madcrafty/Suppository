{
  "version": 3,
  "sources": ["../../rete-context-menu-plugin/src/presets/classic/factory.ts", "../../rete-context-menu-plugin/src/presets/classic/index.ts", "../../rete-context-menu-plugin/src/presets/index.ts", "../../rete-context-menu-plugin/src/index.ts"],
  "sourcesContent": ["import { NodeEditor } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { Item } from '../../types'\nimport { BSchemes, ItemDefinition } from './types'\n\nexport function createItem<S extends BSchemes>(\n  [label, factory]: ItemDefinition<S>,\n  key: string | number,\n  context: { editor: NodeEditor<S>, area: BaseAreaPlugin<S, any> }\n): Item {\n  const item = {\n    label,\n    key: String(key)\n  }\n\n  if (typeof factory === 'function') {\n    return <Item>{\n      ...item,\n      async handler() {\n        const node = await factory()\n\n        await context.editor.addNode(node)\n\n        context.area.translate(node.id, context.area.area.pointer)\n      }\n    }\n  }\n  return <Item>{\n    ...item,\n    handler() {/* do nothing */},\n    subitems: factory.map((data, i) => createItem(data, i, context))\n  }\n}\n", "import { NodeEditor } from 'rete'\nimport { BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { Item, Items } from '../../types'\nimport { createItem } from './factory'\nimport { BSchemes, ItemDefinition } from './types'\n\n/**\n * Classic context menu preset.\n * Configures nodes/actions items for root and Delete/Clone items for nodes\n * @param nodes List of items\n * @example Presets.classic.setup([\n  [\"Math\", [\n    [\"Number\", () => new NumberNode()],\n  ]]\n])\n */\nexport function setup<Schemes extends BSchemes>(nodes: ItemDefinition<Schemes>[]) {\n  return <Items<Schemes>>(function (context, plugin) {\n    const area = plugin.parentScope<BaseAreaPlugin<Schemes, any>>(BaseAreaPlugin)\n    const editor = area.parentScope<NodeEditor<Schemes>>(NodeEditor)\n\n    if (context === 'root') {\n      return {\n        searchBar: true,\n        list: nodes.map((item, i) => createItem(item, i, { editor, area }))\n      }\n    }\n\n    const deleteItem: Item = {\n      label: 'Delete',\n      key: 'delete',\n      async handler() {\n        if ('source' in context && 'target' in context) {\n          // connection\n          const connectionId = context.id\n\n          await editor.removeConnection(connectionId)\n        } else {\n          // node\n          const nodeId = context.id\n          const connections = editor.getConnections().filter(c => {\n            return c.source === nodeId || c.target === nodeId\n          })\n\n          for (const connection of connections) {\n            await editor.removeConnection(connection.id)\n          }\n          await editor.removeNode(nodeId)\n        }\n      }\n    }\n\n    const clone = context.clone\n    const cloneItem: undefined | Item = clone && {\n      label: 'Clone',\n      key: 'clone',\n      async handler() {\n        const node = clone()\n\n        await editor.addNode(node)\n\n        area.translate(node.id, area.area.pointer)\n      }\n    }\n\n    return {\n      searchBar: false,\n      list: [\n        deleteItem,\n        ...(cloneItem ? [cloneItem] : [])\n      ]\n    }\n  })\n}\n", "/**\n * Presets that create items for root and node specific context menu.\n * @module\n*/\n\nexport * as classic from './classic'\n", "import { BaseSchemes, Scope } from 'rete'\nimport { BaseArea, BaseAreaPlugin, RenderSignal } from 'rete-area-plugin'\n\nimport { Item, Items, Position } from './types'\n\nexport * as Presets from './presets'\n\n/**\n * Context menu plugin props\n * @priority 8\n */\nexport type Props<Schemes extends BaseSchemes> = {\n  /** delay before hiding context menu */\n  delay?: number\n  /** menu items, can be produced by preset */\n  items: Items<Schemes>\n}\nexport type RenderMeta = { filled?: boolean }\n\n/**\n * Signal types produced by ContextMenuPlugin instance\n * @priority 10\n */\nexport type ContextMenuExtra =\n  | RenderSignal<'contextmenu', {\n    items: Item[]\n    onHide(): void\n    searchBar?: boolean\n  }>\n\ntype Requires<Schemes extends BaseSchemes> =\n  | { type: 'contextmenu', data: { event: MouseEvent, context: 'root' | Schemes['Node'] | Schemes['Connection'] } }\n  | { type: 'unmount', data: { element: HTMLElement } }\n  | { type: 'pointerdown', data: { position: Position, event: PointerEvent } }\n\n/**\n * Plugin for context menu.\n * Responsible for initialing rendering of context menu with predefined items.\n * @priority 9\n * @emits render\n * @emits unmount\n * @listens unmount\n * @listens contextmenu\n * @listens pointerdown\n */\nexport class ContextMenuPlugin<Schemes extends BaseSchemes> extends Scope<never, [Requires<Schemes> | ContextMenuExtra]> {\n  /**\n   * @param props Properties\n   */\n  constructor(private props: Props<Schemes>) {\n    super('context-menu')\n  }\n\n  setParent(scope: Scope<Requires<Schemes>>): void {\n    super.setParent(scope)\n\n    const area = this.parentScope<BaseAreaPlugin<Schemes, BaseArea<Schemes>>>(BaseAreaPlugin)\n    const container: HTMLElement = (area as any).container\n\n    if (!container || !(container instanceof HTMLElement)) throw new Error('container expected')\n\n    const element = document.createElement('div')\n\n    element.style.display = 'none'\n    element.style.position = 'fixed'\n\n    // eslint-disable-next-line max-statements\n    this.addPipe(context => {\n      const parent = this.parentScope()\n\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\n      if (context.type === 'unmount') {\n        if (context.data.element === element) {\n          element.style.display = 'none'\n        }\n      } else if (context.type === 'contextmenu') {\n        context.data.event.preventDefault()\n        context.data.event.stopPropagation()\n\n        const { searchBar, list } = this.props.items(context.data.context, this)\n\n        container.appendChild(element)\n        element.style.left = `${context.data.event.clientX}px`\n        element.style.top = `${context.data.event.clientY}px`\n        element.style.display = ''\n\n        parent.emit({\n          type: 'render',\n          data: {\n            type: 'contextmenu',\n            element,\n            searchBar,\n            onHide() {\n              parent.emit({ type: 'unmount', data: { element } })\n            },\n            items: list\n          }\n        })\n      } else if (context.type === 'pointerdown') {\n        if (!context.data.event.composedPath().includes(element)) {\n          parent.emit({ type: 'unmount', data: { element } })\n        }\n      }\n      return context\n    })\n  }\n}\n"],
  "mappings": "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",
  "names": ["createItem", "_ref", "key", "context", "_ref2", "_slicedToArray", "label", "factory", "item", "String", "_objectSpread", "handler", "_asyncToGenerator", "_regeneratorRuntime", "mark", "_callee", "node", "wrap", "_callee$", "_context", "prev", "next", "sent", "editor", "addNode", "area", "translate", "id", "pointer", "stop", "subitems", "map", "data", "i", "setup", "nodes", "plugin", "parentScope", "BaseAreaPlugin", "NodeEditor", "searchBar", "list", "deleteItem", "connectionId", "nodeId", "connections", "_iterator", "_step", "connection", "removeConnection", "getConnections", "filter", "c", "source", "target", "_createForOfIteratorHelper", "s", "n", "done", "value", "t0", "e", "f", "finish", "removeNode", "clone", "cloneItem", "_callee2", "_callee2$", "_context2", "concat", "_toConsumableArray", "ContextMenuPlugin", "_Scope", "_inherits", "_super", "_createSuper", "props", "_this", "_classCallCheck", "call", "_createClass", "setParent", "scope", "_this2", "_get", "_getPrototypeOf", "prototype", "container", "HTMLElement", "Error", "element", "document", "createElement", "style", "display", "position", "addPipe", "parent", "_typeof", "type", "event", "preventDefault", "stopPropagation", "_this2$props$items", "items", "appendChild", "left", "clientX", "top", "clientY", "emit", "onHide", "composedPath", "includes", "Scope"]
}
