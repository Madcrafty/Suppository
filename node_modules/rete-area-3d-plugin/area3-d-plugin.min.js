/*!
* rete-area-3d-plugin v2.0.3
* (c) 2024 Vitaliy Stoliarov
* Released under the MIT license.
* */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rete-area-plugin"),require("three"),require("rete-render-utils"),require("rete")):"function"==typeof define&&define.amd?define(["exports","rete-area-plugin","three","rete-render-utils","rete"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Area3DPlugin={},e.ReteAreaPlugin,e.THREE,e.ReteRenderUtils,e.Rete)}(this,(function(e,t,n,r,o){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(){s=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function l(e,t,n,o){var i=t&&t.prototype instanceof f?t:f,a=Object.create(i.prototype),s=new k(o||[]);return r(a,"_invoke",{value:x(e,n,s)}),a}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function f(){}function p(){}function m(){}var v={};u(v,i,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(M([])));b&&b!==t&&n.call(b,i)&&(v=b);var g=m.prototype=f.prototype=Object.create(v);function w(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function o(r,i,a,s){var c=h(e[r],e,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){o("next",e,a,s)}),(function(e){o("throw",e,a,s)})):t.resolve(l).then((function(e){u.value=e,a(u)}),(function(e){return o("throw",e,a,s)}))}s(c.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){o(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function x(e,t,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return T()}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=O(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=h(e,t,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===d)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function O(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,O(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var o=h(r,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,d;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function M(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return p.prototype=m,r(g,"constructor",{value:m,configurable:!0}),r(m,"constructor",{value:p,configurable:!0}),p.displayName=u(m,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,u(e,c,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},w(E.prototype),u(E.prototype,a,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,o,i){void 0===i&&(i=Promise);var a=new E(l(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},w(g),u(g,c,"Generator"),u(g,i,(function(){return this})),u(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=M,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;P(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function u(e,t,n,r,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,o)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function a(e){u(i,r,o,a,s,"next",e)}function s(e){u(i,r,o,a,s,"throw",e)}a(void 0)}))}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,P(r.key),r)}}function f(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,n){return(t=P(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function v(e){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},v(e)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v(e);if(t){var o=v(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}(this,n)}}function w(){return w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=v(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},w.apply(this,arguments)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,s=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(e,t)||O(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||O(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function P(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const k=new n.Vector3,M=new n.Quaternion,T=new n.Vector3;class C extends n.Object3D{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",(function(){this.traverse((function(e){e.element instanceof Element&&null!==e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}))}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const L=new n.Matrix4,S=new n.Matrix4;class A{constructor(e={}){const t=this;let n,r,o,i;const a={camera:{fov:0,style:""},objects:new WeakMap},s=void 0!==e.element?e.element:document.createElement("div");s.style.overflow="hidden",this.domElement=s;const c=document.createElement("div");c.style.transformOrigin="0 0",c.style.pointerEvents="none",s.appendChild(c);const u=document.createElement("div");function l(e){return Math.abs(e)<1e-10?0:e}function h(e){const t=e.elements;return"matrix3d("+l(t[0])+","+l(-t[1])+","+l(t[2])+","+l(t[3])+","+l(t[4])+","+l(-t[5])+","+l(t[6])+","+l(t[7])+","+l(t[8])+","+l(-t[9])+","+l(t[10])+","+l(t[11])+","+l(t[12])+","+l(-t[13])+","+l(t[14])+","+l(t[15])+")"}function d(e){const t=e.elements;return"translate(-50%,-50%)"+("matrix3d("+l(t[0])+","+l(t[1])+","+l(t[2])+","+l(t[3])+","+l(-t[4])+","+l(-t[5])+","+l(-t[6])+","+l(-t[7])+","+l(t[8])+","+l(t[9])+","+l(t[10])+","+l(t[11])+","+l(t[12])+","+l(t[13])+","+l(t[14])+","+l(t[15])+")")}function f(e,n,r,o){if(e.isCSS3DObject){const o=!0===e.visible&&!0===e.layers.test(r.layers);if(e.element.style.display=!0===o?"":"none",!0===o){let o;e.onBeforeRender(t,n,r),e.isCSS3DSprite?(L.copy(r.matrixWorldInverse),L.transpose(),0!==e.rotation2D&&L.multiply(S.makeRotationZ(e.rotation2D)),e.matrixWorld.decompose(k,M,T),L.setPosition(k),L.scale(T),L.elements[3]=0,L.elements[7]=0,L.elements[11]=0,L.elements[15]=1,o=d(L)):o=d(e.matrixWorld);const i=e.element,s=a.objects.get(e);if(void 0===s||s.style!==o){i.style.transform=o;const t={style:o};a.objects.set(e,t)}i.parentNode!==u&&u.appendChild(i),e.onAfterRender(t,n,r)}}for(let t=0,o=e.children.length;t<o;t++)f(e.children[t],n,r)}u.style.transformStyle="preserve-3d",c.appendChild(u),this.getSize=function(){return{width:n,height:r}},this.render=function(e,t){const s=t.projectionMatrix.elements[5]*i;let d,p;a.camera.fov!==s&&(c.style.perspective=t.isPerspectiveCamera?s+"px":"",a.camera.fov=s),t.view&&t.view.enabled?(c.style.transform=`translate( ${-t.view.offsetX*(n/t.view.width)}px, ${-t.view.offsetY*(r/t.view.height)}px )`,c.style.transform+=`scale( ${t.view.fullWidth/t.view.width}, ${t.view.fullHeight/t.view.height} )`):c.style.transform="",!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),null===t.parent&&!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),t.isOrthographicCamera&&(d=-(t.right+t.left)/2,p=(t.top+t.bottom)/2);const m=t.view&&t.view.enabled?t.view.height/t.view.fullHeight:1,v=(t.isOrthographicCamera?`scale( ${m} )scale(`+s+")translate("+l(d)+"px,"+l(p)+"px)"+h(t.matrixWorldInverse):`scale( ${m} )translateZ(`+s+"px)"+h(t.matrixWorldInverse))+"translate("+o+"px,"+i+"px)";a.camera.style!==v&&(u.style.transform=v,a.camera.style=v),f(e,e,t)},this.setSize=function(e,t){n=e,r=t,o=n/2,i=r/2,s.style.width=e+"px",s.style.height=t+"px",c.style.width=e+"px",c.style.height=t+"px",u.style.width=e+"px",u.style.height=t+"px"}}}var R=function(e){m(r,e);var t=g(r);function r(e){var o;h(this,r),(o=t.call(this)).css3dObject=new C(e),o.css3dObject.onAfterRender=function(){var t=" translate(50%, 50%)";e.style.transform.endsWith(t)||(e.style.transform+=t)},o.add(o.css3dObject);var i=new n.Mesh;o.front=i,o.add(i);var a=new n.Mesh;return a.castShadow=!0,o.back=a,o.add(a),o.updateMaterials(),o}return f(r,[{key:"updateGeometry",value:function(e){var t=null==e?void 0:e.clone().scale(1,-1,1);t&&function(e){var t=e.getIndex();if(t)for(var n=t.count/3,r=0;r<n;r++){var o=t.getX(3*r+2),i=t.getX(3*r+1),a=t.getX(3*r);t.setXYZ(3*r,o,i,a)}}(t),this.front&&(this.front.geometry=t||new n.BufferGeometry),this.back&&(this.back.geometry=t||new n.BufferGeometry)}},{key:"updateMaterials",value:function(e){var t;this.front&&(this.front.material=(null==e?void 0:e.front)||(t=!1,new n.ShadowMaterial({transparent:!0,opacity:t?.5:.7,blending:n.NoBlending,side:n.FrontSide}))),this.back&&(this.back.material=(null==e?void 0:e.back)||new n.MeshBasicMaterial({color:7244031,side:n.BackSide}))}}]),r}(n.Object3D);var N=function(){function e(t,n,r){var o;h(this,e),p(this,"objects",new WeakMap),this.scene=t,this.scope=n,this.reordered=r;var i=null===(o=t.renderer.css3d.domElement.firstElementChild)||void 0===o?void 0:o.firstElementChild;if(!(i&&i instanceof HTMLElement))throw new Error("cannot find container for css3d element");this.holder=i}var t;return f(e,[{key:"getPointerFrom",value:function(e){var t=this.holder.getBoundingClientRect(),n=t.left,r=t.top;return{x:e.clientX-n,y:e.clientY-r}}},{key:"add",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new R(e);this.objects.set(e,t),this.holder.appendChild(e),this.scene.add(t,this.scope)}},{key:"reorder",value:(t=l(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.holder.contains(t)){e.next=2;break}throw new Error("content doesn't have 'target' for reordering");case 2:if(null===n||this.holder.contains(n)){e.next=4;break}throw new Error("content doesn't have 'next' for reordering");case 4:return this.holder.insertBefore(t,n),e.next=7,this.reordered(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"remove",value:function(e){var t=this.objects.get(e);t&&(this.objects.delete(e),this.scene.remove(t,this.scope))}},{key:"updateGeometry",value:function(e,t){var n=this.objects.get(e);n&&n.updateGeometry("function"==typeof t?t(n.front.geometry):t)}},{key:"updateMaterials",value:function(e,t){var n=this.objects.get(e);n&&n.updateMaterials(t)}}]),e}(),z=new n.Raycaster,V=function(e){m(r,e);var t=g(r);function r(e,o,i){var a;return h(this,r),p(b(a=t.call(this)),"enabled",!0),p(b(a),"intersections",[]),p(b(a),"selected",null),p(b(a),"hovered",null),p(b(a),"objects",new Set),p(b(a),"pointer",new n.Vector2),p(b(a),"offset",new n.Vector3),p(b(a),"intersection",new n.Vector3),p(b(a),"worldPosition",new n.Vector3),p(b(a),"inverseMatrix",new n.Matrix4),p(b(a),"onPointerMove",(function(e){if(!1!==a.enabled&&(a.updatePointer(e),z.setFromCamera(a.pointer,a.camera),a.selected&&z.ray.intersectPlane(a.getPlane(a.selected),a.intersection))){var t=a.intersection.sub(a.offset).applyMatrix4(a.inverseMatrix),n={type:"drag",object:a.selected,position:t};a.dispatchEvent(n)}})),p(b(a),"onPointerDown",(function(e){if(!1!==a.enabled&&(a.updatePointer(e),a.intersections.length=0,z.setFromCamera(a.pointer,a.camera),a.intersections=z.intersectObjects(a.getObjects(),!0),a.intersections.length>0)){if(a.selected=a.findIntersectedObject(a.intersections)||null,!a.selected)return;if(!a.selected.parent)throw new Error("parent required for selected object");z.ray.intersectPlane(a.getPlane(a.selected),a.intersection)&&(a.inverseMatrix.copy(a.selected.parent.matrixWorld).invert(),a.offset.copy(a.intersection).sub(a.worldPosition.setFromMatrixPosition(a.selected.matrixWorld))),e.stopPropagation(),a.domElement.style.cursor="move";var t={type:"dragstart",object:a.selected};a.dispatchEvent(t)}})),p(b(a),"onPointerCancel",(function(){if(!1!==a.enabled){if(a.selected){var e={type:"dragend",object:a.selected};a.dispatchEvent(e),a.selected=null}a.domElement.style.cursor=a.hovered?"pointer":"auto"}})),p(b(a),"updatePointer",(function(e){var t=a.domElement.getBoundingClientRect();a.pointer.x=(e.clientX-t.left)/t.width*2-1,a.pointer.y=-(e.clientY-t.top)/t.height*2+1})),a.camera=e,a.domElement=o,a.getPlane=i,a.domElement.style.touchAction="none",a.activate(),a}return f(r,[{key:"attach",value:function(e){this.objects.add(e)}},{key:"detach",value:function(e){this.objects.delete(e)}},{key:"activate",value:function(){this.domElement.addEventListener("pointermove",this.onPointerMove),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointerup",this.onPointerCancel),this.domElement.addEventListener("pointerleave",this.onPointerCancel)}},{key:"deactivate",value:function(){this.domElement.removeEventListener("pointermove",this.onPointerMove),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("pointerup",this.onPointerCancel),this.domElement.removeEventListener("pointerleave",this.onPointerCancel),this.domElement.style.cursor=""}},{key:"dispose",value:function(){this.deactivate()}},{key:"getObjects",value:function(){return Array.from(this.objects.values())}},{key:"getRaycaster",value:function(){return z}},{key:"findContainer",value:function(e){var t=null,n=this.getObjects();if(e.object.traverseAncestors((function(e){n.includes(e)&&e instanceof R&&(t=e)})),!t)throw new Error("cannot find Object3D");return t}},{key:"findIntersectedObject",value:function(e){var t,n=this;return(t=e.map((function(e){return n.findContainer(e)}))).sort((function(e,t){if(!e.css3dObject||!t.css3dObject)return 0;var n=e.css3dObject.element.compareDocumentPosition(t.css3dObject.element);return n&Node.DOCUMENT_POSITION_FOLLOWING?1:n&Node.DOCUMENT_POSITION_PRECEDING?-1:0})),t[0]}}]),r}(n.EventDispatcher),_=function(e){m(n,e);var t=g(n);function n(e,r){var o;return h(this,n),(o=t.call(this,e)).events=r,o}return f(n)}(R);var D=function(){function e(){h(this,e),this.css3d=this.getDefaultCSS3DRenderer(),this.webgl=this.getDefaultWebGLRenderer(),this.domElement=document.createElement("div"),this.css3d.domElement.setAttribute("data-css3d","true"),G(this.domElement),G(this.css3d.domElement),G(this.webgl.domElement),this.domElement.appendChild(this.css3d.domElement),this.domElement.appendChild(this.webgl.domElement),this.webgl.domElement.style.pointerEvents="none"}return f(e,[{key:"getContent",value:function(){return this.webgl.domElement.firstElementChild}},{key:"getDefaultCSS3DRenderer",value:function(){return new A}},{key:"getDefaultWebGLRenderer",value:function(){var e=new n.WebGLRenderer({alpha:!1,antialias:!0});return e.setPixelRatio(window.devicePixelRatio),e.setClearColor(16777215,0),e.shadowMap.enabled=!0,e.shadowMap.type=n.PCFSoftShadowMap,e}},{key:"setSize",value:function(e,t){this.css3d.setSize(e,t),this.webgl.setSize(e,t)}},{key:"render",value:function(e,t){this.css3d.render(e,t),this.webgl.render(e,t)}}]),e}();function G(e){e.style.width="100%",e.style.height="100%",e.style.position="absolute",e.style.left="0",e.style.top="0"}const I={type:"change"},H={type:"start"},U={type:"end"},F=new n.Ray,Y=new n.Plane,B=Math.cos(70*n.MathUtils.DEG2RAD);class W extends n.EventDispatcher{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new n.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:n.MOUSE.ROTATE,MIDDLE:n.MOUSE.DOLLY,RIGHT:n.MOUSE.PAN},this.touches={ONE:n.TOUCH.ROTATE,TWO:n.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return s.phi},this.getAzimuthalAngle=function(){return s.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",J),this._domElementKeyEvents=e},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",J),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(I),r.update(),i=o.NONE},this.update=function(){const t=new n.Vector3,h=(new n.Quaternion).setFromUnitVectors(e.up,new n.Vector3(0,1,0)),d=h.clone().invert(),f=new n.Vector3,p=new n.Quaternion,m=new n.Vector3,v=2*Math.PI;return function(y=null){const b=r.object.position;t.copy(b).sub(r.target),t.applyQuaternion(h),s.setFromVector3(t),r.autoRotate&&i===o.NONE&&k(function(e){return null!==e?2*Math.PI/60*r.autoRotateSpeed*e:2*Math.PI/60/60*r.autoRotateSpeed}(y)),r.enableDamping?(s.theta+=c.theta*r.dampingFactor,s.phi+=c.phi*r.dampingFactor):(s.theta+=c.theta,s.phi+=c.phi);let g=r.minAzimuthAngle,O=r.maxAzimuthAngle;isFinite(g)&&isFinite(O)&&(g<-Math.PI?g+=v:g>Math.PI&&(g-=v),O<-Math.PI?O+=v:O>Math.PI&&(O-=v),s.theta=g<=O?Math.max(g,Math.min(O,s.theta)):s.theta>(g+O)/2?Math.max(g,s.theta):Math.min(O,s.theta)),s.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,s.phi)),s.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(l,r.dampingFactor):r.target.add(l),r.zoomToCursor&&x||r.object.isOrthographicCamera?s.radius=N(s.radius):s.radius=N(s.radius*u),t.setFromSpherical(s),t.applyQuaternion(d),b.copy(r.target).add(t),r.object.lookAt(r.target),!0===r.enableDamping?(c.theta*=1-r.dampingFactor,c.phi*=1-r.dampingFactor,l.multiplyScalar(1-r.dampingFactor)):(c.set(0,0,0),l.set(0,0,0));let j=!1;if(r.zoomToCursor&&x){let o=null;if(r.object.isPerspectiveCamera){const e=t.length();o=N(e*u);const n=e-o;r.object.position.addScaledVector(w,n),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){const e=new n.Vector3(E.x,E.y,0);e.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/u)),r.object.updateProjectionMatrix(),j=!0;const i=new n.Vector3(E.x,E.y,0);i.unproject(r.object),r.object.position.sub(i).add(e),r.object.updateMatrixWorld(),o=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==o&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(o).add(r.object.position):(F.origin.copy(r.object.position),F.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(F.direction))<B?e.lookAt(r.target):(Y.setFromNormalAndCoplanarPoint(r.object.up,r.target),F.intersectPlane(Y,r.target))))}else r.object.isOrthographicCamera&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/u)),r.object.updateProjectionMatrix(),j=!0);return u=1,x=!1,!!(j||f.distanceToSquared(r.object.position)>a||8*(1-p.dot(r.object.quaternion))>a||m.distanceToSquared(r.target)>0)&&(r.dispatchEvent(I),f.copy(r.object.position),p.copy(r.object.quaternion),m.copy(r.target),j=!1,!0)}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",ee),r.domElement.removeEventListener("pointerdown",Z),r.domElement.removeEventListener("pointercancel",Q),r.domElement.removeEventListener("wheel",$),r.domElement.removeEventListener("pointermove",q),r.domElement.removeEventListener("pointerup",Q),null!==r._domElementKeyEvents&&(r._domElementKeyEvents.removeEventListener("keydown",J),r._domElementKeyEvents=null)};const r=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let i=o.NONE;const a=1e-6,s=new n.Spherical,c=new n.Spherical;let u=1;const l=new n.Vector3,h=new n.Vector2,d=new n.Vector2,f=new n.Vector2,p=new n.Vector2,m=new n.Vector2,v=new n.Vector2,y=new n.Vector2,b=new n.Vector2,g=new n.Vector2,w=new n.Vector3,E=new n.Vector2;let x=!1;const O=[],j={};function P(){return Math.pow(.95,r.zoomSpeed)}function k(e){c.theta-=e}function M(e){c.phi-=e}const T=function(){const e=new n.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),l.add(e)}}(),C=function(){const e=new n.Vector3;return function(t,n){!0===r.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),l.add(e)}}(),L=function(){const e=new n.Vector3;return function(t,n){const o=r.domElement;if(r.object.isPerspectiveCamera){const i=r.object.position;e.copy(i).sub(r.target);let a=e.length();a*=Math.tan(r.object.fov/2*Math.PI/180),T(2*t*a/o.clientHeight,r.object.matrix),C(2*n*a/o.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(T(t*(r.object.right-r.object.left)/r.object.zoom/o.clientWidth,r.object.matrix),C(n*(r.object.top-r.object.bottom)/r.object.zoom/o.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function S(e){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?u/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function A(e){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?u*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function R(e){if(!r.zoomToCursor)return;x=!0;const t=r.domElement.getBoundingClientRect(),n=e.clientX-t.left,o=e.clientY-t.top,i=t.width,a=t.height;E.x=n/i*2-1,E.y=-o/a*2+1,w.set(E.x,E.y,1).unproject(r.object).sub(r.object.position).normalize()}function N(e){return Math.max(r.minDistance,Math.min(r.maxDistance,e))}function z(e){h.set(e.clientX,e.clientY)}function V(e){p.set(e.clientX,e.clientY)}function _(){if(1===O.length)h.set(O[0].pageX,O[0].pageY);else{const e=.5*(O[0].pageX+O[1].pageX),t=.5*(O[0].pageY+O[1].pageY);h.set(e,t)}}function D(){if(1===O.length)p.set(O[0].pageX,O[0].pageY);else{const e=.5*(O[0].pageX+O[1].pageX),t=.5*(O[0].pageY+O[1].pageY);p.set(e,t)}}function G(){const e=O[0].pageX-O[1].pageX,t=O[0].pageY-O[1].pageY,n=Math.sqrt(e*e+t*t);y.set(0,n)}function W(e){if(1==O.length)d.set(e.pageX,e.pageY);else{const t=ne(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);d.set(n,r)}f.subVectors(d,h).multiplyScalar(r.rotateSpeed);const t=r.domElement;k(2*Math.PI*f.x/t.clientHeight),M(2*Math.PI*f.y/t.clientHeight),h.copy(d)}function X(e){if(1===O.length)m.set(e.pageX,e.pageY);else{const t=ne(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);m.set(n,r)}v.subVectors(m,p).multiplyScalar(r.panSpeed),L(v.x,v.y),p.copy(m)}function K(e){const t=ne(e),n=e.pageX-t.x,o=e.pageY-t.y,i=Math.sqrt(n*n+o*o);b.set(0,i),g.set(0,Math.pow(b.y/y.y,r.zoomSpeed)),S(g.y),y.copy(b)}function Z(e){!1!==r.enabled&&(0===O.length&&(r.domElement.setPointerCapture(e.pointerId),r.domElement.addEventListener("pointermove",q),r.domElement.addEventListener("pointerup",Q)),function(e){O.push(e)}(e),"touch"===e.pointerType?function(e){switch(te(e),O.length){case 1:switch(r.touches.ONE){case n.TOUCH.ROTATE:if(!1===r.enableRotate)return;_(),i=o.TOUCH_ROTATE;break;case n.TOUCH.PAN:if(!1===r.enablePan)return;D(),i=o.TOUCH_PAN;break;default:i=o.NONE}break;case 2:switch(r.touches.TWO){case n.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&G(),r.enablePan&&D(),i=o.TOUCH_DOLLY_PAN;break;case n.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&G(),r.enableRotate&&_(),i=o.TOUCH_DOLLY_ROTATE;break;default:i=o.NONE}break;default:i=o.NONE}i!==o.NONE&&r.dispatchEvent(H)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case n.MOUSE.DOLLY:if(!1===r.enableZoom)return;!function(e){R(e),y.set(e.clientX,e.clientY)}(e),i=o.DOLLY;break;case n.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;V(e),i=o.PAN}else{if(!1===r.enableRotate)return;z(e),i=o.ROTATE}break;case n.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;z(e),i=o.ROTATE}else{if(!1===r.enablePan)return;V(e),i=o.PAN}break;default:i=o.NONE}i!==o.NONE&&r.dispatchEvent(H)}(e))}function q(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(te(e),i){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;W(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;X(e),r.update();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;!function(e){r.enableZoom&&K(e),r.enablePan&&X(e)}(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;!function(e){r.enableZoom&&K(e),r.enableRotate&&W(e)}(e),r.update();break;default:i=o.NONE}}(e):function(e){switch(i){case o.ROTATE:if(!1===r.enableRotate)return;!function(e){d.set(e.clientX,e.clientY),f.subVectors(d,h).multiplyScalar(r.rotateSpeed);const t=r.domElement;k(2*Math.PI*f.x/t.clientHeight),M(2*Math.PI*f.y/t.clientHeight),h.copy(d),r.update()}(e);break;case o.DOLLY:if(!1===r.enableZoom)return;!function(e){b.set(e.clientX,e.clientY),g.subVectors(b,y),g.y>0?S(P()):g.y<0&&A(P()),y.copy(b),r.update()}(e);break;case o.PAN:if(!1===r.enablePan)return;!function(e){m.set(e.clientX,e.clientY),v.subVectors(m,p).multiplyScalar(r.panSpeed),L(v.x,v.y),p.copy(m),r.update()}(e)}}(e))}function Q(e){!function(e){delete j[e.pointerId];for(let t=0;t<O.length;t++)if(O[t].pointerId==e.pointerId)return void O.splice(t,1)}(e),0===O.length&&(r.domElement.releasePointerCapture(e.pointerId),r.domElement.removeEventListener("pointermove",q),r.domElement.removeEventListener("pointerup",Q)),r.dispatchEvent(U),i=o.NONE}function $(e){!1!==r.enabled&&!1!==r.enableZoom&&i===o.NONE&&(e.preventDefault(),r.dispatchEvent(H),function(e){R(e),e.deltaY<0?A(P()):e.deltaY>0&&S(P()),r.update()}(e),r.dispatchEvent(U))}function J(e){!1!==r.enabled&&!1!==r.enablePan&&function(e){let t=!1;switch(e.code){case r.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?M(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):L(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?M(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):L(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?k(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):L(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?k(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):L(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}(e)}function ee(e){!1!==r.enabled&&e.preventDefault()}function te(e){let t=j[e.pointerId];void 0===t&&(t=new n.Vector2,j[e.pointerId]=t),t.set(e.pageX,e.pageY)}function ne(e){const t=e.pointerId===O[0].pointerId?O[1]:O[0];return j[t.pointerId]}r.domElement.addEventListener("contextmenu",ee),r.domElement.addEventListener("pointerdown",Z),r.domElement.addEventListener("pointercancel",Q),r.domElement.addEventListener("wheel",$,{passive:!1}),this.update()}}var X=function(){function e(t){h(this,e),p(this,"root",new n.Scene),p(this,"canvases",new Map),this.container=t,this.camera=new n.PerspectiveCamera,this.camera.position.set(0,0,1e3),this.camera.fov=45,this.camera.near=1,this.camera.far=4e3,this.renderer=new D,t.appendChild(this.renderer.domElement),this.orbit=this.createOrbitControls(),this.controls=this.createDragControls(this.orbit)}return f(e,[{key:"createOrbitControls",value:function(){var e=new W(this.camera,this.renderer.domElement);e.update();var t=0;return e.addEventListener("start",(function(){t=0})),e.addEventListener("change",(function(){t++})),this.renderer.domElement.addEventListener("contextmenu",(function(e){t>5&&e.stopPropagation()})),e}},{key:"createDragControls",value:function(e){var t=this,n=new V(this.camera,this.renderer.domElement,(function(e){var n=e.parent;if(!n)throw new Error("object doesnt have parent");if(!Array.from(t.canvases.values()).includes(n))throw new Error("object parent isnt canvas");return t.canvasToPlane(n)}));return function(e){e.addEventListener("dragstart",(function(e){var t=e;t.object instanceof _&&t.object.events.start()})),e.addEventListener("drag",(function(e){var t=e;if(t.object instanceof _){var n=t.position,r=n.x,o=n.y,i=n.z;t.object.events.translate(r,o,i)}})),e.addEventListener("dragend",(function(e){var t=e;t.object instanceof _&&t.object.events.drag()}))}(n),n.addEventListener("dragstart",(function(){return e.enabled=!1})),n.addEventListener("dragend",(function(){return e.enabled=!0})),n}},{key:"canvasToPlane",value:function(e){var t=new n.Plane,r=new n.Vector3(0,0,1);return r.applyQuaternion(e.quaternion),t.setFromNormalAndCoplanarPoint(r,e.position.clone()),t}},{key:"addCanvasFor",value:function(e){var t=new n.Object3D;t.scale.set(1,-1,1),this.canvases.set(e,t),this.root.add(t)}},{key:"resize",value:function(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}},{key:"render",value:function(){this.renderer.render(this.root,this.camera)}},{key:"getCanvasFor",value:function(e){var t=this.canvases.get(e);if(!t)throw new Error("cannot find canvas for the scope");return t}},{key:"add",value:function(e,t){e.scale.set(1,-1,1),this.getCanvasFor(t).add(e),e instanceof _&&this.controls.attach(e),this.render()}},{key:"remove",value:function(e,t){this.getCanvasFor(t).remove(e),e instanceof _&&this.controls.detach(e),this.render()}},{key:"getPointerFrom",value:function(e,t){var r=this.container.getBoundingClientRect(),o=new n.Raycaster,i=new n.Vector2((e.clientX-r.left)/r.width*2-1,-(e.clientY-r.top)/r.height*2+1);o.setFromCamera(i,this.camera);var a=this.getCanvasFor(t),s=this.canvasToPlane(a),c=o.ray.intersectPlane(s,new n.Vector3);return c?a.worldToLocal(c):null}}]),e}(),K=function(){function e(t,n,r,o,i){var a,c,u,d,f,m,v=this;h(this,e),p(this,"pointer",{x:0,y:0}),p(this,"pointerdown",(function(e){v.setPointerFrom(e),v.events.pointerDown(v.pointer,e)})),p(this,"pointermove",(function(e){v.setPointerFrom(e),v.events.pointerMove(v.pointer,e)})),p(this,"pointerup",(function(e){v.setPointerFrom(e),v.events.pointerUp(v.pointer,e)})),p(this,"resize",(function(e){v.events.resize(e),v.scene.resize(v.container.clientWidth,v.container.clientHeight)})),this.container=t,this.scope=r,this.events=o,this.guards=i,this.scene=n||new X(this.container),this.content=new N(this.scene,r,(function(e){return v.events.reordered(e)})),this.container.addEventListener("pointerdown",this.pointerdown),this.container.addEventListener("pointermove",this.pointermove),window.addEventListener("pointerup",this.pointerup),window.addEventListener("resize",this.resize),a=this.scene.orbit,c=this.scene.camera,u=function(e,t){return v.guards.transform({previous:t,current:e})},d=function(e,t){return v.events.transformed({previous:t,current:e})},a.addEventListener("change",l(s().mark((function e(){var t,n,r,o,i,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.position.clone(),n=c.rotation.clone(),e.next=4,u({position:t,rotation:n},f);case 4:if(!e.sent){e.next=9;break}f={position:t,rotation:n},m=a.target.clone(),e.next=13;break;case 9:return f&&m&&(o=(r=f).position,i=r.rotation,l=m,c.position.fromArray([o.x,o.y,o.z]),c.rotation.fromArray([i.x,i.y,i.z]),a.target.fromArray([l.x,l.y,l.z])),a.update(),e.next=13,d({position:t,rotation:n},f);case 13:case"end":return e.stop()}}),e)})))),this.scene.resize(this.container.clientWidth,this.container.clientHeight)}return f(e,[{key:"getCanvas",value:function(){return this.scene.canvases.get(this.scope)}},{key:"setPointerFrom",value:function(e){var t=this.scene.getPointerFrom(e,this.scope);t&&(this.pointer={x:t.x,y:t.y})}},{key:"destroy",value:function(){this.container.removeEventListener("pointerdown",this.pointerdown),this.container.removeEventListener("pointermove",this.pointermove),window.removeEventListener("pointerup",this.pointerup),window.removeEventListener("resize",this.resize)}}]),e}(),Z=f((function e(t){h(this,e),this.element=document.createElement("div"),this.element.style.position="absolute",this.element.style.left="0",this.element.style.top="0",this.element.addEventListener("contextmenu",(function(e){return t.contextmenu(e)})),this.object=new R(this.element)})),q=function(){function e(){h(this,e),p(this,"views",new WeakMap),p(this,"viewsElements",new Map)}return f(e,[{key:"set",value:function(e){var t=e.element,n=e.type,r=e.payload;null!=r&&r.id&&(this.views.set(t,e),this.viewsElements.set("".concat(n,"_").concat(r.id),t))}},{key:"get",value:function(e,t){var n=this.viewsElements.get("".concat(e,"_").concat(t));return n&&this.views.get(n)}},{key:"delete",value:function(e){var t,n=this.views.get(e);n&&null!==(t=n.payload)&&void 0!==t&&t.id&&(this.views.delete(e),this.viewsElements.delete("".concat(n.type,"_").concat(n.payload.id)))}}]),e}(),Q=function(){function e(t,n){var r=this;h(this,e),p(this,"translate",function(){var e=l(s().mark((function e(t,n){var o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a({},r.position),e.next=3,r.guards.translate({previous:o,position:{x:t,y:n}});case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return",!1);case 6:return r.position=a({},i.data.position),r.object.position.set(r.position.x,r.position.y,r.object.position.z),e.next=10,r.events.translated({position:r.position,previous:o});case 10:return e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),p(this,"resize",function(){var e=l(s().mark((function e(t,n){var o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={width:t,height:n},e.next=3,r.guards.resize({size:o});case 3:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:if((i=r.element.children.item(0))&&i instanceof HTMLElement){e.next=8;break}return e.abrupt("return",!1);case 8:return i.style.width="".concat(t,"px"),i.style.height="".concat(n,"px"),e.next=12,r.events.resized({size:o});case 12:return e.abrupt("return",!0);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.events=t,this.guards=n,this.element=document.createElement("div"),this.element.style.position="absolute",this.position={x:0,y:0},this.translate(0,0),this.element.addEventListener("contextmenu",(function(e){return r.events.contextmenu(e)})),this.object=new _(this.element,{start:this.events.picked,translate:this.translate,drag:this.events.dragged})}return f(e,[{key:"destroy",value:function(){}}]),e}();function $(e,t,r){var o=new n.Shape;return o.moveTo(0+r,0),o.lineTo(0+e-r,0),o.quadraticCurveTo(0+e,0,0+e,0+r),o.lineTo(0+e,0+t-r),o.quadraticCurveTo(0+e,0+t,0+e-r,0+t),o.lineTo(0+r,0+t),o.quadraticCurveTo(0,0+t,0,0+t-r),o.lineTo(0,0+r),o.quadraticCurveTo(0,0,0+r,0),o.closePath(),o}function J(e,t,r,o){var i=$(e,t,18),a=new n.ShapeGeometry(i);return a.__commentGeometry={width:e,height:t,x:r,y:o},a.translate(r,o,0),a}function ee(e,t){e.area.content.updateGeometry(t.element,(function(e){var n=null==e?void 0:e.__commentGeometry;if(n){if(n.width!==t.width||n.height!==t.height)return J(t.width,t.height,t.x,t.y);if(n.x!==t.x||n.y!==t.y)return null==e?void 0:e.translate(t.x-n.x,t.y-n.y,0)}return J(t.width,t.height,t.x,t.y)}))}function te(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ne=function(e){var t=[];return e.replace(oe,(function(e,n,r){var o=n.toLowerCase();for(r=function(e){var t=e.match(ie);return t?t.map(Number):[]}(r),"m"==o&&r.length>2&&(t.push([n].concat(r.splice(0,2))),o="l",n="m"==n?"l":"L");;){if(r.length==re[o])return r.unshift(n),t.push(r);if(r.length<re[o])throw new Error("malformed path data");t.push([n].concat(r.splice(0,re[o])))}})),t},re={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},oe=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var ie=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi;var ae=te(ne);function se(e){return[e[0],e[1]]}function ce(e,t){return[e,t]}var ue=function(e){var t="number"==typeof(e=e||{}).recursion?e.recursion:8,n="number"==typeof e.epsilon?e.epsilon:1.1920929e-7,r="number"==typeof e.pathEpsilon?e.pathEpsilon:1,o="number"==typeof e.angleEpsilon?e.angleEpsilon:.01,i=e.angleTolerance||0,a=e.cuspLimit||0;return function(e,t,n,o,i,a){a||(a=[]);var c=r/(i="number"==typeof i?i:1);return function(e,t,n,r,o,i){o.push(se(e));var a=e[0],c=e[1],u=t[0],l=t[1],h=n[0],d=n[1],f=r[0],p=r[1];s(a,c,u,l,h,d,f,p,o,i,0),o.push(se(r))}(e,t,n,o,a,c*=c),a};function s(e,r,c,u,l,h,d,f,p,m,v){if(!(v>t)){var y=Math.PI,b=(e+c)/2,g=(r+u)/2,w=(c+l)/2,E=(u+h)/2,x=(l+d)/2,O=(h+f)/2,j=(b+w)/2,P=(g+E)/2,k=(w+x)/2,M=(E+O)/2,T=(j+k)/2,C=(P+M)/2;if(v>0){var L,S,A=d-e,R=f-r,N=Math.abs((c-d)*R-(u-f)*A),z=Math.abs((l-d)*R-(h-f)*A);if(N>n&&z>n){if((N+z)*(N+z)<=m*(A*A+R*R)){if(i<o)return void p.push(ce(T,C));var V=Math.atan2(h-u,l-c);if((L=Math.abs(V-Math.atan2(u-r,c-e)))>=y&&(L=2*y-L),(S=Math.abs(Math.atan2(f-h,d-l)-V))>=y&&(S=2*y-S),L+S<i)return void p.push(ce(T,C));if(0!==a){if(L>a)return void p.push(ce(c,u));if(S>a)return void p.push(ce(l,h))}}}else if(N>n){if(N*N<=m*(A*A+R*R)){if(i<o)return void p.push(ce(T,C));if((L=Math.abs(Math.atan2(h-u,l-c)-Math.atan2(u-r,c-e)))>=y&&(L=2*y-L),L<i)return p.push(ce(c,u)),void p.push(ce(l,h));if(0!==a&&L>a)return void p.push(ce(c,u))}}else if(z>n){if(z*z<=m*(A*A+R*R)){if(i<o)return void p.push(ce(T,C));if((L=Math.abs(Math.atan2(f-h,d-l)-Math.atan2(h-u,l-c)))>=y&&(L=2*y-L),L<i)return p.push(ce(c,u)),void p.push(ce(l,h));if(0!==a&&L>a)return void p.push(ce(l,h))}}else if((A=T-(e+d)/2)*A+(R=C-(r+f)/2)*R<=m)return void p.push(ce(T,C))}s(e,r,b,g,j,P,T,C,p,m,v+1),s(T,C,k,M,x,O,d,f,p,m,v+1)}}}(),le=function(e){var t=0,n=0,r=0,o=0;return e.map((function(e){var i=(e=e.slice())[0],a=i.toUpperCase();if(i!=a)switch(e[0]=a,i){case"a":e[6]+=r,e[7]+=o;break;case"v":e[1]+=o;break;case"h":e[1]+=r;break;default:for(var s=1;s<e.length;)e[s++]+=r,e[s++]+=o}switch(a){case"Z":r=t,o=n;break;case"H":r=e[1];break;case"V":o=e[1];break;case"M":r=t=e[1],o=n=e[2];break;default:r=e[e.length-2],o=e[e.length-1]}return e}))};var he=Math.PI,de=ye(120);function fe(e,t,n,r){return["C",e,t,n,r,n,r]}function pe(e,t,n,r,o,i){return["C",e/3+2/3*n,t/3+2/3*r,o/3+2/3*n,i/3+2/3*r,o,i]}function me(e,t,n,r,o,i,a,s,c,u){if(u)g=u[0],w=u[1],y=u[2],b=u[3];else{var l=ve(e,t,-o);e=l.x,t=l.y;var h=(e-(s=(l=ve(s,c,-o)).x))/2,d=(t-(c=l.y))/2,f=h*h/(n*n)+d*d/(r*r);f>1&&(n*=f=Math.sqrt(f),r*=f);var p=n*n,m=r*r,v=(i==a?-1:1)*Math.sqrt(Math.abs((p*m-p*d*d-m*h*h)/(p*d*d+m*h*h)));v==1/0&&(v=1);var y=v*n*d/r+(e+s)/2,b=v*-r*h/n+(t+c)/2,g=Math.asin(((t-b)/r).toFixed(9)),w=Math.asin(((c-b)/r).toFixed(9));(g=e<y?he-g:g)<0&&(g=2*he+g),(w=s<y?he-w:w)<0&&(w=2*he+w),a&&g>w&&(g-=2*he),!a&&w>g&&(w-=2*he)}if(Math.abs(w-g)>de){var E=w,x=s,O=c;w=g+de*(a&&w>g?1:-1);var j=me(s=y+n*Math.cos(w),c=b+r*Math.sin(w),n,r,o,0,a,x,O,[w,E,y,b])}var P=Math.tan((w-g)/4),k=4/3*n*P,M=4/3*r*P,T=[2*e-(e+k*Math.sin(g)),2*t-(t-M*Math.cos(g)),s+k*Math.sin(w),c-M*Math.cos(w),s,c];if(u)return T;j&&(T=T.concat(j));for(var C=0;C<T.length;){var L=ve(T[C],T[C+1],o);T[C++]=L.x,T[C++]=L.y}return T}function ve(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}function ye(e){return e*(he/180)}var be=ue,ge=le,we=function(e){for(var t,n=[],r=0,o=0,i=0,a=0,s=null,c=null,u=0,l=0,h=0,d=e.length;h<d;h++){var f=e[h],p=f[0];switch(p){case"M":i=f[1],a=f[2];break;case"A":(f=me(u,l,f[1],f[2],ye(f[3]),f[4],f[5],f[6],f[7])).unshift("C"),f.length>7&&(n.push(f.splice(0,7)),f.unshift("C"));break;case"S":var m=u,v=l;"C"!=t&&"S"!=t||(m+=m-r,v+=v-o),f=["C",m,v,f[1],f[2],f[3],f[4]];break;case"T":"Q"==t||"T"==t?(s=2*u-s,c=2*l-c):(s=u,c=l),f=pe(u,l,s,c,f[1],f[2]);break;case"Q":s=f[1],c=f[2],f=pe(u,l,f[1],f[2],f[3],f[4]);break;case"L":f=fe(u,l,f[1],f[2]);break;case"H":f=fe(u,l,f[1],l);break;case"V":f=fe(u,l,u,f[1]);break;case"Z":f=fe(u,l,i,a)}t=p,u=f[f.length-2],l=f[f.length-1],f.length>4?(r=f[f.length-4],o=f[f.length-3]):(r=u,o=l),n.push(f)}return n},Ee=function(e,t){return e[0]=t[0],e[1]=t[1],e};function xe(e,t,n){return e[0]=t,e[1]=n,e}var Oe=[0,0],je=[0,0],Pe=[0,0];var ke=function(e,t){var n=[],r=[],o=[0,0];return we(ge(e)).forEach((function(e,i,a){if("M"===e[0])Ee(o,e.slice(1)),r.length>0&&(n.push(r),r=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);!function(e,t,n,r){be(n,xe(Oe,r[1],r[2]),xe(je,r[3],r[4]),xe(Pe,r[5],r[6]),t,e)}(r,t,o,e),xe(o,e[5],e[6])}})),r.length>0&&n.push(r),n},Me=te(ke);function Te(e,t){for(var r=Me(ae(e)).map((function(e){return e.map((function(e){var t=E(e,2);return{x:t[0],y:t[1]}}))})).flat(),o=new n.PlaneGeometry(100,10,r.length-1,1),i=0;i<r.length;i++){var a=new n.Vector2(0,t/2),s=new n.Vector2(r[i].x,r[i].y);if(i>0&&i<r.length-1){var c=new n.Vector2(r[i-1].x,r[i-1].y),u=new n.Vector2(r[i+1].x,r[i+1].y).clone().sub(c),l=new n.Vector2(-u.y,u.x).clone().normalize();a.set(l.x,l.y).multiplyScalar(t/2)}o.attributes.position.setX(i,s.x+a.x),o.attributes.position.setY(i,s.y+a.y),o.attributes.position.setX(i+r.length,s.x-a.x),o.attributes.position.setY(i+r.length,s.y-a.y)}return o}function Ce(e,t=!1){const r=null!==e[0].index,o=new Set(Object.keys(e[0].attributes)),i=new Set(Object.keys(e[0].morphAttributes)),a={},s={},c=e[0].morphTargetsRelative,u=new n.BufferGeometry;let l=0;for(let n=0;n<e.length;++n){const h=e[n];let d=0;if(r!==(null!==h.index))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const e in h.attributes){if(!o.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+'. All geometries must have compatible attributes; make sure "'+e+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[e]&&(a[e]=[]),a[e].push(h.attributes[e]),d++}if(d!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". Make sure all geometries have the same number of attributes."),null;if(c!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const e in h.morphAttributes){if(!i.has(e))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===s[e]&&(s[e]=[]),s[e].push(h.morphAttributes[e])}if(t){let e;if(r)e=h.index.count;else{if(void 0===h.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+n+". The geometry must have either an index or a position attribute"),null;e=h.attributes.position.count}u.addGroup(l,e,n),l+=e}}if(r){let t=0;const n=[];for(let r=0;r<e.length;++r){const o=e[r].index;for(let e=0;e<o.count;++e)n.push(o.getX(e)+t);t+=e[r].attributes.position.count}u.setIndex(n)}for(const e in a){const t=Le(a[e]);if(!t)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" attribute."),null;u.setAttribute(e,t)}for(const e in s){const t=s[e][0].length;if(0===t)break;u.morphAttributes=u.morphAttributes||{},u.morphAttributes[e]=[];for(let n=0;n<t;++n){const t=[];for(let r=0;r<s[e].length;++r)t.push(s[e][r][n]);const r=Le(t);if(!r)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+e+" morphAttribute."),null;u.morphAttributes[e].push(r)}}return u}function Le(e){let t,r,o,i=-1,a=0;for(let n=0;n<e.length;++n){const s=e[n];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===t&&(t=s.array.constructor),t!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===r&&(r=s.itemSize),r!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===o&&(o=s.normalized),o!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(-1===i&&(i=s.gpuType),i!==s.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;a+=s.array.length}const s=new t(a);let c=0;for(let t=0;t<e.length;++t)s.set(e[t].array,c),c+=e[t].array.length;const u=new n.BufferAttribute(s,r,o);return void 0!==i&&(u.gpuType=i),u}function Se(e,t){var r=t||{},o=r.borderRadius,i=void 0===o?10:o,a=r.inputsOffset,s=void 0===a?15.5:a,c=r.outputsOffset,u=void 0===c?44.5:c,l=r.socketRadius,h=void 0===l?12.3:l,d=r.socketMargin,f=void 0===d?11.5:d,p=$(e.width-1,e.height-1,1.05*i),m=new n.ShapeGeometry(p),v=new n.CircleGeometry(h,16),y=[];if("inputs"in e)for(var b=Object.entries(e.inputs).length,g=0;g<b;g++){var w=v.clone(),E=e.height-h-s-(2*h+f)*g;w.translate(1.5,E,0),y.push(w)}if("outputs"in e)for(var x=Object.entries(e.outputs).length,O=0;O<x;O++){var j=v.clone(),P=e.width-1.5,k=h+u+(2*h+f)*O;j.translate(P,k,0),y.push(j)}return Ce([].concat(y,[m]))}var Ae=Object.freeze({__proto__:null,comment:function(e){var t=e,n=t.parentScope(_e);t.addPipe((function(e){if("commentcreated"===e.type&&ee(n,e.data),"commenttranslated"===e.type){var r=e.data.id,o=t.comments.get(r);o&&ee(n,o)}return e}))},connection:function(e,t){var n=e,o=n.parentScope(_e);n.addPipe((function(e){if(!e||"object"!==c(e)||!("type"in e))return e;if("connectionpath"===e.type){var n=e.data.payload.id,i=o.connectionViews.get(n);if(i){var a=e.data.path||r.classicConnectionPath(e.data.points,.3),s=null!=t&&t.customize?t.customize(a):Te(a,4.6);s&&o.area.content.updateGeometry(i.element,s)}}return e}))},createClassicConnectionGeometry:Te,createClassicNodeGeometry:Se,node:function(e,t){var n=e.parentScope(o.NodeEditor);e.addPipe((function(r){if(!r||"object"!==c(r)||!("type"in r))return r;if("render"===r.type&&"node"===r.data.type){var o=r.data.payload.id,i=n.getNode(o),a=null!=t&&t.customize?t.customize(i):Se(i);e.area.content.updateGeometry(r.data.element,a)}return r}))},reroute:function(e){if(!(e instanceof _e))throw new Error("");var t=e;t.addPipe((function(e){if(!e||"object"!==c(e)||!("type"in e))return e;if("render"===e.type&&"reroute-pins"===e.data.type){var r=new n.CircleGeometry(10,16),o=e.data.data.pins.map((function(e){return r.clone().translate(e.position.x,e.position.y,0)}));t.area.content.updateGeometry(e.data.element,o.length?Ce(o):void 0)}return e}))}}),Re=function(e){return 0===e.length?0:Math.min.apply(Math,x(e))},Ne=function(e){return 0===e.length?0:Math.max.apply(Math,x(e))};function ze(e,t){var n=e.parentScope(o.NodeEditor),r=t.map((function(e){return"object"===c(e)?e:n.getNode(e)})),i=function(e,t){return e.map((function(e){return{view:t.get(e.id),node:e}})).filter((function(e){return e.view})).map((function(e){var t=e.view,n=e.node,r=n.width,o=n.height;return void 0!==r&&void 0!==o?{position:t.position,width:r,height:o}:{position:t.position,width:t.element.clientWidth,height:t.element.clientHeight}}))}(r,e.nodeViews);return function(e){var t=Re(e.map((function(e){return e.position.x}))),n=Re(e.map((function(e){return e.position.y}))),r=Ne(e.map((function(e){return e.position.x+e.width}))),o=Ne(e.map((function(e){return e.position.y+e.height})));return{left:t,right:r,top:n,bottom:o,width:Math.abs(t-r),height:Math.abs(n-o),center:{x:(t+r)/2,y:(n+o)/2}}}(i)}var Ve=Object.freeze({__proto__:null,forms:Ae,animate:function(e,t){!function n(r){t&&t(r),e.area.scene.render(),requestAnimationFrame((function(e){return n(e)}))}(performance.now())},lookAt:function(e,t,r){var o=(r||{}).scale,i=void 0===o?.9:o,a=e.area.scene,s=a.camera,c=a.orbit,u=a.canvases.get(e),l=ze(e,t);if(!u)throw new Error("cannot found canvas");var h=function(e,t,n,r){var o=e.fov*(Math.PI/180),i=2*Math.atan(Math.tan(o/2)*e.aspect),a=Math.abs(n.width/2/Math.tan(i/2)),s=Math.abs(n.height/2/Math.tan(o/2)),c=Math.abs(t.clientHeight/2/Math.tan(o/2)),u=Math.max(a,s,c);return u/r}(s,e.container,l,i),d=new n.Vector3(l.center.x,l.center.y,0),f=d.clone().add(new n.Vector3(0,0,h));u.localToWorld(d),u.localToWorld(f),s.position.copy(f),c.target.copy(d),c.update()}}),_e=function(e){m(i,e);var t,n,r,o=g(i);function i(e){var t;return h(this,i),p(b(t=o.call(this,"area-3d")),"nodeViews",new Map),p(b(t),"connectionViews",new Map),p(b(t),"elements",new q),p(b(t),"onContextMenu",(function(e){t.emit({type:"contextmenu",data:{event:e,context:"root"}})})),t.container=e instanceof i?e.container:e,t.container.style.overflow="hidden",t.container.addEventListener("contextmenu",t.onContextMenu),t.area=new K(t.container,e instanceof i?e.area.scene:null,b(t),{pointerDown:function(e,n){return t.emit({type:"pointerdown",data:{position:e,event:n}})},pointerMove:function(e,n){return t.emit({type:"pointermove",data:{position:e,event:n}})},pointerUp:function(e,n){return t.emit({type:"pointerup",data:{position:e,event:n}})},resize:function(e){return t.emit({type:"resized",data:{event:e}})},transformed:function(e){return t.emit({type:"transformed",data:e})},reordered:function(e){return t.emit({type:"reordered",data:{element:e}})}},{transform:function(e){return t.emit({type:"transform",data:e})}}),t.area.scene.addCanvasFor(b(t)),t}return f(i,[{key:"share",value:function(){return new i(this)}},{key:"setParent",value:function(e){var t=this;w(v(i.prototype),"setParent",this).call(this,e),this.addPipe((function(e){return e&&"object"===c(e)&&"type"in e?("nodecreated"===e.type&&t.addNodeView(e.data),"noderemoved"===e.type&&t.removeNodeView(e.data.id),"connectioncreated"===e.type&&t.addConnectionView(e.data),"connectionremoved"===e.type&&t.removeConnectionView(e.data.id),"render"===e.type&&t.elements.set(e.data),"unmount"===e.type&&t.elements.delete(e.data.element),e):e}))}},{key:"addNodeView",value:function(e){var t=this,n=e.id,r=new Q({picked:function(){return t.emit({type:"nodepicked",data:{id:n}})},translated:function(e){return t.emit({type:"nodetranslated",data:a({id:n},e)})},dragged:function(){return t.emit({type:"nodedragged",data:e})},contextmenu:function(n){return t.emit({type:"contextmenu",data:{event:n,context:e}})},resized:function(n){var r=n.size;return t.emit({type:"noderesized",data:{id:e.id,size:r}})}},{translate:function(e){return t.emit({type:"nodetranslate",data:a({id:n},e)})},resize:function(n){var r=n.size;return t.emit({type:"noderesize",data:{id:e.id,size:r}})}});return this.nodeViews.set(n,r),this.area.content.add(r.element,r.object),this.emit({type:"render",data:{element:r.element,type:"node",payload:e}}),r}},{key:"removeNodeView",value:function(e){var t=this.nodeViews.get(e);t&&(this.emit({type:"unmount",data:{element:t.element}}),this.nodeViews.delete(e),this.area.content.remove(t.element))}},{key:"addConnectionView",value:function(e){var t=this,n=new Z({contextmenu:function(n){return t.emit({type:"contextmenu",data:{event:n,context:e}})}});return this.connectionViews.set(e.id,n),this.area.content.add(n.element,n.object),this.emit({type:"render",data:{element:n.element,type:"connection",payload:e}}),n}},{key:"removeConnectionView",value:function(e){var t=this.connectionViews.get(e);t&&(this.emit({type:"unmount",data:{element:t.element}}),this.connectionViews.delete(e),this.area.content.remove(t.element))}},{key:"translate",value:(r=l(s().mark((function e(t,n){var r,o,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.x,o=n.y,!(i=this.nodeViews.get(t))){e.next=6;break}return e.next=5,i.translate(r,o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"resize",value:(n=l(s().mark((function e(t,n,r){var o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=this.nodeViews.get(t))){e.next=5;break}return e.next=4,o.resize(n,r);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"update",value:(t=l(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.elements.get(t,n))){e.next=4;break}return e.next=4,this.emit({type:"render",data:r});case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=this;this.container.removeEventListener("contextmenu",this.onContextMenu),Array.from(this.connectionViews.keys()).forEach((function(t){return e.removeConnectionView(t)})),Array.from(this.nodeViews.keys()).forEach((function(t){return e.removeNodeView(t)})),this.area.destroy()}}]),i}(t.BaseAreaPlugin);e.Area3DExtensions=Ve,e.Area3DPlugin=_e,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=area3-d-plugin.min.js.map
