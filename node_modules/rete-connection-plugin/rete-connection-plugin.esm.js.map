{"version":3,"file":"rete-connection-plugin.esm.js","sources":["src/pseudoconnection.ts","src/utils.ts","src/flow/base.ts","src/flow/utils.ts","src/flow/builtin/bidirect.ts","src/flow/builtin/classic/sync-connections.ts","src/flow/builtin/classic/index.ts","src/presets/classic.ts","src/presets/index.ts","src/index.ts"],"sourcesContent":["import { getUID } from 'rete'\nimport { BaseArea, BaseAreaPlugin } from 'rete-area-plugin'\n\nimport { ClassicScheme, Position, SocketData } from './types'\n\n/**\n * Create pseudoconnection. Used to trigger rendering of connection that is being created by user.\n * Has additional `isPseudo` property in payload.\n * @param extra Extra payload to add to connection\n */\nexport function createPseudoconnection<Schemes extends ClassicScheme, K>(extra?: Partial<Schemes['Connection']>) {\n  let element: HTMLElement | null = null\n  let id: string | null = null\n\n  function unmount(areaPlugin: BaseAreaPlugin<Schemes, BaseArea<Schemes> | K>) {\n    if (id) {\n      areaPlugin.removeConnectionView(id)\n    }\n    element = null\n    id = null\n  }\n  function mount(areaPlugin: BaseAreaPlugin<Schemes, BaseArea<Schemes> | K>) {\n    unmount(areaPlugin)\n    id = `pseudo_${getUID()}`\n  }\n\n  return {\n    isMounted() {\n      return Boolean(id)\n    },\n    mount,\n    // eslint-disable-next-line complexity\n    render(areaPlugin: BaseAreaPlugin<Schemes, BaseArea<Schemes> | K>, { x, y }: Position, data: SocketData) {\n      const isOutput = data.side === 'output'\n      const pointer = { x: x + (isOutput ? -3 : 3), y } // fix hover of underlying elements\n\n      if (!id) throw new Error('pseudo connection id wasn\\'t generated')\n\n      const payload = isOutput ? {\n        id,\n        source: data.nodeId,\n        sourceOutput: data.key,\n        target: '',\n        targetInput: '',\n        ...(extra || {})\n      } : {\n        id,\n        target: data.nodeId,\n        targetInput: data.key,\n        source: '',\n        sourceOutput: '',\n        ...(extra || {})\n      }\n\n      if (!element) {\n        const view = areaPlugin.addConnectionView(payload)\n\n        element = view.element\n      }\n\n      if (!element) return\n\n      areaPlugin.emit({\n        type: 'render', data: {\n          element,\n          type: 'connection',\n          payload,\n          ...(isOutput ? { end: pointer } : { start: pointer })\n        }\n      })\n    },\n    unmount\n  }\n}\n","import { SocketData } from './types'\n/**\n * @param elements list of Element returned by document.elementsFromPoint\n */\nexport function findSocket(socketsCache: WeakMap<Element, SocketData>, elements: Element[]) {\n  for (const element of elements) {\n    const found = socketsCache.get(element)\n\n    if (found) {\n      return found\n    }\n  }\n}\n","import { BaseSchemes, NodeEditor, Scope } from 'rete'\n\nimport { Connection, SocketData } from '../types'\n\nexport type Context<Schemes extends BaseSchemes, K extends any[]> = {\n    editor: NodeEditor<Schemes>\n    scope: Scope<Connection, K>\n    socketsCache: Map<Element, SocketData>\n}\nexport type EventType = 'up' | 'down'\nexport type PickParams = { socket: SocketData, event: EventType }\n\nexport abstract class Flow<Schemes extends BaseSchemes, K extends any[]> {\n    public abstract pick(params: PickParams, context: Context<Schemes, K>): Promise<void>\n    public abstract getPickedSocket(): SocketData | undefined\n    public abstract drop(context: Context<Schemes, K>): void\n}\n","import { getUID } from 'rete'\n\nimport { ClassicScheme, SocketData } from '../types'\nimport { Context, PickParams } from './base'\n\nexport interface StateContext<Schemes extends ClassicScheme, K extends any[]> {\n  currentState: State<Schemes, K>\n  switchTo(state: State<Schemes, K>): void\n}\n\nexport abstract class State<Schemes extends ClassicScheme, K extends any[]> {\n  context!: StateContext<Schemes, K>\n  initial: SocketData | undefined\n\n  setContext(context: StateContext<Schemes, K>) {\n    this.context = context\n  }\n\n  abstract pick(params: PickParams, context: Context<Schemes, K>): Promise<void>\n  abstract drop(context: Context<Schemes, K>): void\n}\n\nexport function getSourceTarget(initial: SocketData, socket: SocketData) {\n  const forward = initial.side === 'output' && socket.side === 'input'\n  const backward = initial.side === 'input' && socket.side === 'output'\n  const [source, target] = forward\n    ? [initial, socket]\n    : (backward ? [socket, initial] : [])\n\n  if (source && target) return [source, target]\n}\n\nexport function canMakeConnection(initial: SocketData, socket: SocketData) {\n  return Boolean(getSourceTarget(initial, socket))\n}\n\nexport function makeConnection<Schemes extends ClassicScheme, K extends any[]>(initial: SocketData, socket: SocketData, context: Context<Schemes, K>) {\n  const [source, target] = getSourceTarget(initial, socket) || [null, null]\n\n  if (source && target) {\n    context.editor.addConnection({\n      id: getUID(),\n      source: source.nodeId,\n      sourceOutput: source.key,\n      target: target.nodeId,\n      targetInput: target.key\n    })\n    return true\n  }\n}\n","import { ClassicScheme, SocketData } from '../../types'\nimport { Context, Flow, PickParams } from '../base'\nimport { makeConnection as defaultMakeConnection, State, StateContext } from '../utils'\n\n/**\n * Bidirect flow params\n */\nexport type BidirectParams<Schemes extends ClassicScheme> = {\n  /** If true, user can pick a pseudo-connection by clicking on socket, not only by pointerdown */\n  pickByClick: boolean\n  /** Custom function to make connection */\n  makeConnection: <K extends any[]>(from: SocketData, to: SocketData, context: Context<Schemes, K>) => boolean | undefined\n}\n\nclass Picked<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\n  constructor(public initial: SocketData, private params: BidirectParams<Schemes>) {\n    super()\n  }\n\n  async pick({ socket }: PickParams, context: Context<Schemes, K>): Promise<void> {\n    if (this.params.makeConnection(this.initial, socket, context)) {\n      this.drop(context, socket, true)\n    } else if (!this.params.pickByClick) {\n      this.drop(context, socket)\n    }\n  }\n\n  drop(context: Context<ClassicScheme, K>, socket: SocketData | null = null, created = false): void {\n    if (this.initial) {\n      context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\n    }\n    this.context.switchTo(new Idle<Schemes, K>(this.params))\n  }\n}\n\nclass Idle<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\n  constructor(private params: BidirectParams<Schemes>) {\n    super()\n  }\n\n  async pick({ socket, event }: PickParams, context: Context<Schemes, K>): Promise<void> {\n    if (event === 'down') {\n      if (await context.scope.emit({ type: 'connectionpick', data: { socket } })) {\n        this.context.switchTo(new Picked(socket, this.params))\n      } else {\n        this.drop(context)\n      }\n    }\n  }\n\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\n    if (this.initial) {\n      context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\n    }\n    delete this.initial\n  }\n}\n\n/**\n * Bidirect flow. User can pick a socket and connect it by releasing mouse button.\n * More simple than classic flow, but less functional (can't remove connection by clicking on input socket).\n */\nexport class BidirectFlow<Schemes extends ClassicScheme, K extends any[]> implements StateContext<Schemes, K>, Flow<Schemes, K> {\n  currentState!: State<Schemes, K>\n\n  constructor(params?: Partial<BidirectParams<Schemes>>) {\n    const pickByClick = Boolean(params?.pickByClick)\n    const makeConnection = params?.makeConnection || defaultMakeConnection\n\n    this.switchTo(new Idle({ pickByClick, makeConnection }))\n  }\n\n  public async pick(params: PickParams, context: Context<Schemes, K>) {\n    await this.currentState.pick(params, context)\n  }\n\n  public getPickedSocket() {\n    return this.currentState.initial\n  }\n\n  public drop(context: Context<Schemes, K>) {\n    this.currentState.drop(context)\n  }\n\n  public switchTo(state: State<Schemes, K>): void {\n    state.setContext(this)\n    this.currentState = state\n  }\n}\n","import { NodeEditor } from 'rete'\n\nimport { ClassicScheme, SocketData } from '../../../types'\n\nfunction findPort<Schemes extends ClassicScheme>(socket: SocketData, editor: NodeEditor<Schemes>) {\n  const node = editor.getNode(socket.nodeId)\n\n  if (!node) throw new Error('cannot find node')\n\n  const list = socket.side === 'input' ? node.inputs : node.outputs\n\n  return list[socket.key]\n}\nfunction findConnections<Schemes extends ClassicScheme>(socket: SocketData, editor: NodeEditor<Schemes>) {\n  const { nodeId, side, key } = socket\n\n  return editor.getConnections().filter(connection => {\n    if (side === 'input') {\n      return connection.target === nodeId && connection.targetInput === key\n    }\n    if (side === 'output') {\n      return connection.source === nodeId && connection.sourceOutput === key\n    }\n  })\n}\n\n/**\n * Remove existing connections if Port doesnt allow multiple connections\n */\nexport function syncConnections<Schemes extends ClassicScheme>(sockets: SocketData[], editor: NodeEditor<Schemes>) {\n  const connections: Schemes['Connection'][] = sockets.map(socket => {\n    const port = findPort(socket, editor)\n    const multiple = port?.multipleConnections\n\n    if (multiple) return []\n\n    return findConnections(socket, editor)\n  }).flat()\n\n  return {\n    commit() {\n      const uniqueIds = Array.from(new Set(connections.map(({ id }) => id)))\n\n      uniqueIds.forEach(id => editor.removeConnection(id))\n    }\n  }\n}\n","\nimport { ClassicScheme, SocketData } from '../../../types'\nimport { Context, Flow, PickParams } from '../../base'\nimport {\n  canMakeConnection as defaultCanMakeConnection, makeConnection as defaultMakeConnection, State, StateContext\n} from '../../utils'\nimport { syncConnections } from './sync-connections'\n\n/**\n * Classic flow params\n */\nexport type ClassicParams<Schemes extends ClassicScheme> = {\n  /** Custom function to check if connection can be made */\n  canMakeConnection: (from: SocketData, to: SocketData) => boolean | undefined\n  /** Custom function to make connection */\n  makeConnection: <K extends any[]>(from: SocketData, to: SocketData, context: Context<Schemes, K>) => boolean | undefined\n}\n\nclass Picked<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\n  constructor(public initial: SocketData, private params: ClassicParams<Schemes>) {\n    super()\n  }\n\n  async pick({ socket }: PickParams, context: Context<Schemes, K>): Promise<void> {\n    if (this.params.canMakeConnection(this.initial, socket)) {\n      syncConnections([this.initial, socket], context.editor).commit()\n      const created = this.params.makeConnection(this.initial, socket, context)\n\n      this.drop(context, created ? socket : null, created)\n    }\n  }\n\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\n    if (this.initial) {\n      context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\n    }\n    this.context.switchTo(new Idle(this.params))\n  }\n}\n\nclass PickedExisting<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\n  initial!: SocketData\n  outputSocket: SocketData\n\n  constructor(public connection: Schemes['Connection'], private params: ClassicParams<Schemes>, context: Context<Schemes, K>) {\n    super()\n    const outputSocket = Array.from(context.socketsCache.values()).find(data => {\n      return data.nodeId === this.connection.source\n        && data.side === 'output'\n        && data.key === this.connection.sourceOutput\n    })\n\n    if (!outputSocket) throw new Error('cannot find output socket')\n\n    this.outputSocket = outputSocket\n  }\n\n  async init(context: Context<Schemes, K>) {\n    context.scope.emit({ type: 'connectionpick', data: { socket: this.outputSocket } }).then(response => {\n      if (response) {\n        context.editor.removeConnection(this.connection.id)\n        this.initial = this.outputSocket\n      } else {\n        this.drop(context)\n      }\n    })\n  }\n\n  async pick({ socket, event }: PickParams, context: Context<Schemes, K>): Promise<void> {\n    if (this.initial && !(socket.side === 'input' && this.connection.target === socket.nodeId && this.connection.targetInput === socket.key)) {\n      if (this.params.canMakeConnection(this.initial, socket)) {\n        syncConnections([this.initial, socket], context.editor).commit()\n        const created = this.params.makeConnection(this.initial, socket, context)\n\n        this.drop(context, created ? socket : null, created)\n      }\n    } else if (event === 'down') {\n      if (this.initial) {\n        syncConnections([this.initial, socket], context.editor).commit()\n        const created = this.params.makeConnection(this.initial, socket, context)\n\n        this.drop(context, created ? socket : null, created)\n      }\n    }\n  }\n\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\n    if (this.initial) {\n      context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\n    }\n    this.context.switchTo(new Idle<Schemes, K>(this.params))\n  }\n}\n\nclass Idle<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\n  constructor(private params: ClassicParams<Schemes>) {\n    super()\n  }\n\n  async pick({ socket, event }: PickParams, context: Context<Schemes, K>): Promise<void> {\n    if (event !== 'down') return\n    if (socket.side === 'input') {\n      const connection = context\n        .editor.getConnections()\n        .find(item => item.target === socket.nodeId && item.targetInput === socket.key)\n\n      if (connection) {\n        const state = new PickedExisting(connection, this.params, context)\n\n        await state.init(context)\n        this.context.switchTo(state)\n        return\n      }\n    }\n\n    if (await context.scope.emit({ type: 'connectionpick', data: { socket } })) {\n      this.context.switchTo(new Picked(socket, this.params))\n    } else {\n      this.drop(context)\n    }\n  }\n\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\n    if (this.initial) {\n      context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\n    }\n    delete this.initial\n  }\n}\n\n/**\n * Classic flow. User can pick/click a socket and connect it by releasing/clicking on another socket.\n * If connection already exists and user clicks on input socket, connection will be removed.\n */\nexport class ClassicFlow<Schemes extends ClassicScheme, K extends any[]> implements StateContext<Schemes, K>, Flow<Schemes, K> {\n  currentState!: State<Schemes, K>\n\n  constructor(params?: Partial<ClassicParams<Schemes>>) {\n    const canMakeConnection = params?.canMakeConnection || defaultCanMakeConnection\n    const makeConnection = params?.makeConnection || defaultMakeConnection\n\n    this.switchTo(new Idle<Schemes, K>({ canMakeConnection, makeConnection }))\n  }\n\n  public async pick(params: PickParams, context: Context<Schemes, K>) {\n    await this.currentState.pick(params, context)\n  }\n\n  public getPickedSocket() {\n    return this.currentState.initial\n  }\n\n  public switchTo(state: State<Schemes, K>): void {\n    state.setContext(this)\n    this.currentState = state\n  }\n\n  public drop(context: Context<Schemes, K>) {\n    this.currentState.drop(context)\n  }\n}\n","import { ClassicFlow } from '../flow'\n\n/**\n * Classic preset. Uses `ClassicFlow` for managing connections by user\n */\nexport function setup() {\n  return () => new ClassicFlow()\n}\n","/**\n * Built-in presets\n * @module\n */\nexport * as classic from './classic'\n","import { NodeEditor, Scope } from 'rete'\nimport { BaseArea, BaseAreaPlugin, RenderSignal } from 'rete-area-plugin'\n\nimport { Flow } from './flow'\nimport { EventType } from './flow/base'\nimport { createPseudoconnection } from './pseudoconnection'\nimport { ClassicScheme, Connection, Position, Preset, Side, SocketData } from './types'\nimport { findSocket } from './utils'\n\nexport * from './flow'\nexport * as Presets from './presets'\nexport { createPseudoconnection } from './pseudoconnection'\nexport type { Connection, ConnectionExtra, Preset, Side, SocketData } from './types'\n\ntype Requires =\n  | { type: 'pointermove', data: { position: Position, event: PointerEvent } }\n  | { type: 'pointerup', data: { position: Position, event: PointerEvent } }\n  | RenderSignal<'socket', {\n    nodeId: string,\n    side: Side,\n    key: string\n  }>\n  | { type: 'unmount', data: { element: HTMLElement } }\n\n/**\n * Connection plugin. Responsible for user interaction with connections (creation, deletion)\n * @priority 9\n * @emits connectionpick\n * @emits connectiondrop\n * @listens pointermove\n * @listens pointerup\n * @listens render\n * @listens unmount\n */\nexport class ConnectionPlugin<Schemes extends ClassicScheme, K = Requires> extends Scope<Connection, [Requires | K]> {\n  presets: Preset<Schemes>[] = []\n  private areaPlugin!: BaseAreaPlugin<Schemes, BaseArea<Schemes>>\n  private editor!: NodeEditor<Schemes>\n  private currentFlow: Flow<Schemes, any[]> | null = null\n  private preudoconnection = createPseudoconnection({ isPseudo: true })\n  private socketsCache = new Map<Element, SocketData>()\n\n  constructor() {\n    super('connection')\n  }\n\n  /**\n   * Add preset to the plugin\n   * @param preset Preset to add\n   */\n  public addPreset(preset: Preset<Schemes>) {\n    this.presets.push(preset)\n  }\n\n  private findPreset(data: SocketData) {\n    for (const preset of this.presets) {\n      const flow = preset(data)\n\n      if (flow) return flow\n    }\n    return null\n  }\n\n  update() {\n    if (!this.currentFlow) return\n    const socket = this.currentFlow.getPickedSocket()\n\n    if (socket) {\n      this.preudoconnection.render(this.areaPlugin, this.areaPlugin.area.pointer, socket)\n    }\n  }\n\n  /**\n   * Drop pseudo-connection if exists\n   * @emits connectiondrop\n   */\n  drop() {\n    const flowContext = { editor: this.editor, scope: this, socketsCache: this.socketsCache }\n\n    if (this.currentFlow) {\n      this.currentFlow.drop(flowContext)\n      this.preudoconnection.unmount(this.areaPlugin)\n      this.currentFlow = null\n    }\n  }\n\n  // eslint-disable-next-line max-statements\n  async pick(event: PointerEvent, type: EventType) {\n    const flowContext = { editor: this.editor, scope: this, socketsCache: this.socketsCache }\n    const pointedElements = document.elementsFromPoint(event.clientX, event.clientY)\n    const pickedSocket = findSocket(this.socketsCache, pointedElements)\n\n    if (pickedSocket) {\n      event.preventDefault()\n      event.stopPropagation()\n      this.currentFlow = this.currentFlow || this.findPreset(pickedSocket)\n\n      if (this.currentFlow) {\n        await this.currentFlow.pick({ socket: pickedSocket, event: type }, flowContext)\n        this.preudoconnection.mount(this.areaPlugin)\n      }\n    } else if (this.currentFlow) {\n      this.currentFlow.drop(flowContext)\n    }\n    if (this.currentFlow && !this.currentFlow.getPickedSocket()) {\n      this.preudoconnection.unmount(this.areaPlugin)\n      this.currentFlow = null\n    }\n    this.update()\n  }\n\n  setParent(scope: Scope<Requires | K>): void {\n    super.setParent(scope)\n    this.areaPlugin = this.parentScope<BaseAreaPlugin<Schemes, BaseArea<Schemes>>>(BaseAreaPlugin)\n    this.editor = this.areaPlugin.parentScope<NodeEditor<Schemes>>(NodeEditor)\n\n    const pointerdownSocket = (e: PointerEvent) => {\n      this.pick(e, 'down')\n    }\n\n    // eslint-disable-next-line max-statements\n    this.addPipe(context => {\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\n\n      if (context.type === 'pointermove') {\n        this.update()\n      } else if (context.type === 'pointerup') {\n        this.pick(context.data.event, 'up')\n      } else if (context.type === 'render') {\n        if (context.data.type === 'socket') {\n          const { element } = context.data\n\n          element.addEventListener('pointerdown', pointerdownSocket)\n          this.socketsCache.set(element, context.data)\n        }\n      } else if (context.type === 'unmount') {\n        const { element } = context.data\n\n        element.removeEventListener('pointerdown', pointerdownSocket)\n        this.socketsCache.delete(element)\n      }\n      return context\n    })\n  }\n}\n"],"names":["createPseudoconnection","extra","element","id","unmount","areaPlugin","removeConnectionView","mount","concat","getUID","isMounted","Boolean","render","_ref","data","x","y","isOutput","side","pointer","Error","payload","_objectSpread","source","nodeId","sourceOutput","key","target","targetInput","view","addConnectionView","emit","type","end","start","findSocket","socketsCache","elements","_iterator","_createForOfIteratorHelper","_step","s","n","done","value","found","get","err","e","f","Flow","_createClass","_classCallCheck","State","setContext","context","getSourceTarget","initial","socket","forward","backward","_ref2","_slicedToArray","canMakeConnection","makeConnection","_ref3","_ref4","editor","addConnection","Picked","_State","_inherits","_super","_createSuper","params","_this","call","_pick","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","drop","pickByClick","stop","pick","_x","_x2","apply","arguments","length","undefined","created","scope","switchTo","Idle","_State2","_super2","_this2","_pick2","_callee2","event","_callee2$","_context2","sent","_x3","_x4","BidirectFlow","defaultMakeConnection","_pick3","_callee3","_callee3$","_context3","currentState","_x5","_x6","getPickedSocket","state","findPort","node","getNode","list","inputs","outputs","findConnections","getConnections","filter","connection","syncConnections","sockets","connections","map","port","multiple","multipleConnections","flat","commit","uniqueIds","Array","from","Set","forEach","removeConnection","PickedExisting","outputSocket","values","find","_init","_this3","then","response","init","_created","_State3","_super3","_this4","_callee4","_connection","_callee4$","_context4","abrupt","item","_x7","ClassicFlow","defaultCanMakeConnection","_pick4","_callee5","_callee5$","_context5","_x8","_x9","setup","ConnectionPlugin","_Scope","_defineProperty","_assertThisInitialized","isPseudo","Map","addPreset","preset","presets","push","findPreset","flow","update","currentFlow","preudoconnection","area","flowContext","pointedElements","pickedSocket","document","elementsFromPoint","clientX","clientY","preventDefault","stopPropagation","setParent","_get","_getPrototypeOf","prototype","parentScope","BaseAreaPlugin","NodeEditor","pointerdownSocket","addPipe","_typeof","addEventListener","set","removeEventListener","Scope"],"mappings":"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"}